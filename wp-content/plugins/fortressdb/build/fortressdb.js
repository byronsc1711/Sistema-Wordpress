!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("FDBLib"),require("FDBLib").Components):"function"==typeof define&&define.amd?define("fortressdb",["FDBLib"],t):"object"==typeof exports?exports.fortressdb=t(require("FDBLib"),require("FDBLib").Components):e.fortressdb=t(e.FDBLib,e.FDBLib.Components)}(self,(function(e,t){return(()=>{var n,r={7679:(e,t,n)=>{"use strict";n.r(t),n.d(t,{App:()=>a,Coupon:()=>me,DataChart:()=>Te,DataTable:()=>$t,Endpoint:()=>T.F,HttpRequest:()=>A.a,Layout:()=>le,NameForm:()=>an,OptionsList:()=>y.OptionsList,PageHeader:()=>bn,Price:()=>y.Price,Property:()=>yn,SelectPicklist:()=>xn,SelectTable:()=>Tn,SortableList:()=>Fn,TariffPlan:()=>Jn,TypeControl:()=>nr,Watcher:()=>z,blocks:()=>u,file:()=>Yc,pages:()=>r,socket:()=>F.W});var r={};n.r(r);var a={};n.r(a),n.d(a,{Component:()=>ne,Context:()=>te,Provider:()=>ee});var o={};n.r(o),n.d(o,{Edit:()=>kr,Save:()=>xr,View:()=>Zr,className:()=>Or});var c={};n.r(c),n.d(c,{Edit:()=>Kr,Save:()=>$r,View:()=>ra,className:()=>Gr});var l={};n.r(l),n.d(l,{Edit:()=>pa,Save:()=>ma,View:()=>Ma,className:()=>da});var i={};n.r(i),n.d(i,{Edit:()=>vo,Save:()=>go,View:()=>So,className:()=>yo});var s={};n.r(s),n.d(s,{CustomDataClassName:()=>fc,CustomDataEdit:()=>uc,CustomDataSave:()=>dc,CustomDataView:()=>Bc,TemplateEdit:()=>Hc,TemplateSave:()=>Jc});var u={};n.r(u),n.d(u,{chart:()=>c,custom_data:()=>s,map:()=>i,price:()=>l,table:()=>o}),n(1897);var f=n(6156),p=n(6610),d=n(5991),m=n(5255),b=n(6070),v=n(7608),y=n(9948),g=n(4699),h=n(3804),E=n.n(h),w=n(2137);const k=window.regeneratorRuntime;var O,x,N,C=n.n(k),j=n(3861),S=y.Utils.applyDiscount,P=(O=6e4*(new Date).getTimezoneOffset(),x=0===O,N=/\.\d+Z$/,function(e){if(!e)return"";if(x)return e;try{return new Date(new Date(e).getTime()-O).toISOString().replace(N,"")}catch(e){}return e});function Z(e){var t=e%60,n=e/60>>0,r=n%60,a=n/60>>0,o=a<10?"0".concat(a):"".concat(a),c=r<10?"0".concat(r):"".concat(r),l=t<10?"0".concat(t):"".concat(t);return"".concat(o,":").concat(c,":").concat(l)}function _(e){switch(e){case"string":case"text":case"json":case"uuid":return String();case"integer":case"float":return Number();case"boolean":return Boolean();case"date":case"datetime":return(new Date).toISOString();case"time":case"enum":return 0;case"file":return null}}var D=n(312),T=n(2361),I=n(9187),A=n(5716),q=(y.Utils.isDoubleTouch,y.Constants.LOCATIONS),B=y.Constants.DEFAULT_LOCATION,F=(y.Utils.renderDOM,n(2092)),M=y.Utils.loadStripe,R=y.Utils.useDictionary;n.g.fdbLocale=n.g.fortressdbUserLocale;var L=y.Utils.usePrevious,V=y.Utils.usePromise,U=y.Utils.useTimeout;var z=function(e){(0,m.Z)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,v.Z)(t);if(n){var a=(0,v.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,b.Z)(this,e)});function a(e){return(0,p.Z)(this,a),r.call(this,e,F.W)}return a}(j.Watcher),W=new T.F("options");function H(e){var t=(0,h.useContext)(y.App.Context),r=(t.state.options,t.dispatch),a=(0,h.useState)(!1),o=(0,g.Z)(a,2),c=o[0],l=o[1],i=(0,h.useRef)({optionsRequest:function(){return(0,w.Z)(C().mark((function e(){var t,n;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W.get().json();case 3:t=e.sent,r({options:t}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),n=e.t0.message,r({error:n});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()}}).current;return(0,h.useEffect)((function(){n.g.fortressdbInitialOptions?(r({options:n.g.fortressdbInitialOptions}),l(!0)):(0,w.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({fetching:!0}),l(!0),e.prev=2,e.next=5,i.optionsRequest();case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:r({fetching:!1});case 10:case"end":return e.stop()}}),e,null,[[2,7]])})))(),F.W.authenticate().then((function(){F.W.on("authenticate",i.optionsRequest)})).catch((function(){}))}),[]),c?e.children:null}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=new z("licenses");function G(e){var t=(0,h.useContext)(y.App.Context),n=t.state,r=t.dispatch,a=(0,h.useRef)({updateLicenses:function(e,t){if(t)r({error:t.message});else{var n=e.license,a=n.usedResources,o=void 0===a?[]:a,c=n.plan,l=void 0===c?"FREE":c,i=n.status,s=n.expired,u=n.discount,f=e.plans,p=void 0===f?[]:f,d=p.find((function(e){return(e.period||[]).find((function(e){return e.id===l}))}));if(d){var m=d.period.find((function(e){return e.id===l})),b={plans:p,currentPlanId:l,currentPlanData:d,currentPeriod:m,price:m.price,discount:u,status:i,expired:s,usedResources:o,resources:d.restrictions.map((function(e){var t=o.find((function(t){return e.name===t.name}));return t?-1!==e.value?Y(Y({},e),{},{allow:-1!==t.value||e.value<t.value,limit:e.value,value:t.value}):Y(Y({},e),{},{allow:!0,value:t.value}):Y(Y({},e),{},{allow:!0})}))};r({license:b})}}}}).current,o=n.options||{},c=o.connected,l=o.email,i=o.useCustomServer,s=o.location;return(0,h.useEffect)((function(){if(c)return(0,w.Z)(C().mark((function e(){var t;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({fetching:!0}),e.prev=1,e.next=4,K.subscribe({context:{email:l,location:i?"custom":s}},a.updateLicenses);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),t=e.t0.message,r({error:t});case 10:r({fetching:!1});case 11:case"end":return e.stop()}}),e,null,[[1,6]])})))(),function(){K.unsubscribe()}}),[c,l,i,s]),e.children}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t){return X(X({},e),t)}function ee(e){var t=e.children,n=e.license,r=void 0!==n&&n,a=(0,h.useReducer)(Q,{}),o=(0,g.Z)(a,2),c=o[0],l=o[1],i=(0,h.useMemo)((function(){return{state:c,dispatch:l}}),[c]);return E().createElement(y.App.Context.Provider,{value:i},E().createElement(H,null,r?E().createElement(G,null,t):t))}ee.displayName="Provider";var te=y.App.Context,ne=y.App.Component,re=n(2122),ae=n(7375),oe=E().useMemo,ce={none:"fortressdb-layout-none",block:"fortressdb-layout-block",row:"fortressdb-layout-row",col:"fortressdb-layout-col",align:"fortressdb-layout-align",left:"fortressdb-layout-left",right:"fortressdb-layout-right",top:"fortressdb-layout-top",bottom:"fortressdb-layout-bottom",horizontal:"fortressdb-layout-horizontal",vertical:"fortressdb-layout-vertical",space:"fortressdb-layout-space",between:"fortressdb-layout-between",around:"fortressdb-layout-around",evenly:"fortressdb-layout-evenly",flex:"fortressdb-layout-flex",fill:"fortressdb-layout-fill",content:"fortressdb-layout-content",wrap:"fortressdb-layout-wrap",ellipsis:"fortressdb-layout-ellipsis",scroll:"fortressdb-layout-scroll",background:"fortressdb-layout-background",contain:"fortressdb-layout-contain",relative:"fortressdb-layout-relative",absolute:"fortressdb-layout-absolute",fixed:"fortressdb-layout-fixed"},le=E().forwardRef((function(e,t){var n=e.type,r=e.className,a=e.children,o=e.style,c=(0,ae.Z)(e,["type","className","children","style"]),l=oe((function(){return(n||"").split(" ").map((function(e){return e.trim()})).map((function(e){return e&&ce[e]})).concat([r]).filter((function(e){return e})).join(" ")}),[n,r]);return E().createElement("div",(0,re.Z)({ref:t,className:l,style:o||{}},c),a)})),ie=E().useEffect,se=E().useState,ue=E().useRef,fe=E().useCallback,pe=E().useContext,de="fortressdb-component-coupon";function me(e){var t=e.onDiscount,n=e.onFetching,r=se(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=se(""),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=pe(te).state.options,p=U(),d=p.setTimeout,m=p.clearTimeout,b=ue({timeout:null}).current,v=f.useCustomServer,h=f.location,k=fe(function(){var e=(0,w.Z)(C().mark((function e(r){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.timeout&&(m(b.timeout),b.timeout=null),b.timeout=d((0,w.Z)(C().mark((function e(){var a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return t&&t(null),e.abrupt("return");case 3:return c(!0),n&&n(!0),e.prev=5,e.next=8,F.W.get("coupons",{filter:{id:r,location:v?"custom":h}});case 8:a=e.sent,t&&t(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),t&&t(null);case 15:c(!1),n&&n(!1);case 17:case"end":return e.stop()}}),e,null,[[5,12]])}))),500);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);ie((function(){u(e.code||"")}),[e.code||""]),ie((function(){k(s)}),[s]);var O=fe(function(){var e=(0,w.Z)(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(t.target.value.trim());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),x=R();return E().createElement("div",{className:de},E().createElement("div",{className:"".concat(de,"__icon-wrapper"),title:x("coupon")},E().createElement(y.Icon,{color:"white",icon:"label"})),E().createElement(y.Input,{value:s,onChange:O,placeholder:x("enter-code-here")}),o&&E().createElement(y.Spinner,null))}me.displayName="Coupon";var be=n(7329),ve=n(484),ye=n(8446),ge=n.n(ye);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var we=E().useCallback,ke=E().useState,Oe=E().useEffect,xe=E().useMemo,Ne=(E().useRef,E().Fragment),Ce=["string","enum"],je=["date"],Se=["integer","float"];function Pe(e){var t=(e||{}).type;switch(!0){case Se.indexOf(t)>=0:return"number";case Ce.indexOf(t)>=0:return"string";case je.indexOf(t)>=0:return"datetime"}}function Ze(e,t){var n=t.fields.find((function(t){return t.name===e}));return n?n.name:e}var _e=new z("objects"),De=new z("enum_values");function Te(e){var t=e.chart,n=e.dataSettings,r=e.table,a=ke(!1),o=(0,g.Z)(a,2),c=o[0],l=o[1],i=ke(null),s=(0,g.Z)(i,2),u=s[0],f=s[1],p=ke(null),d=(0,g.Z)(p,2),m=d[0],b=d[1],v=ke({}),h=(0,g.Z)(v,2),w=h[0],k=h[1],O=we((function(e,t){if(t)f(t.message);else{var n=e.rows;b(n),f(null)}}),[]),x=we((function(e,t){t?f(t.message):(k(Object.keys(e).reduce((function(t,n){return t[n]=e[n].rows,t}),{})),f(null))}),[]),N=(r||{}).tableName,C=L(n),S=L(N),P=xe((function(){if(m&&n&&r)return function(e,t,n,r){var a=t.x,o=t.y,c=[a].concat((0,be.Z)(o)).map((function(e){return e&&n.find((function(t){return t.name===e}))})).filter((function(e){return e})).map((function(e){return Ee({name:e.name,type:Pe(e),caption:e.extend.caption},"enum"===e.type?{enumId:e.extend.enumId}:{})})).filter((function(e){return e.type})),l=[];return e.forEach((function(e){var t=[];c.forEach((function(n){var a=n.name,o=n.type,c=n.enumId;t.push(function(e,t,n,r){switch(t){case"datetime":if("object"!==(0,ve.Z)(e))return new Date(e);break;case"number":if("number"!=typeof e)return Number(e);break;case"string":if(n){var a=e?Array.isArray(e)?e:[e]:[],o=(r||{})[n]||[];return a.map((function(e){return(o.find((function(t){return t.id===e}))||{}).label||e})).join(", ")||String(e)}if("string"!=typeof e)return String(e)}return e}(e[a],o,c,r))})),l.push(t)})),{cols:c.map((function(e){return{type:e.type,caption:e.caption}})),rows:l}}(m,n,r.fields,w)}),[m,n,r,w]);return Oe((function(){if(N&&n&&(N!==S||!ge()(n,C))){var e=n.x,t=n.y,a=n.order,o=n.group;if(!e||!t.length)return;l(!0),b(null);var c=Ze(e,r);if(_e.subscribe({context:{tableName:N},filter:Ee(Ee({},a?{order:[j.query.orderBy(c,a)]}:o?{order:[j.query.orderBy(j.query.fn("min","id").as("id"))]}:{order:[j.query.orderBy("id")]}),o?{attributes:[j.query.col(c).as(e)].concat((0,be.Z)(t.map((function(e){return j.query.fn(o,Ze(e,r)).as(e)})))),group:[c]}:{attributes:[j.query.col(c).as(e)].concat((0,be.Z)(t.map((function(e){return j.query.col(Ze(e,r)).as(e)}))))})},O).catch((function(e){f(e.message)})).finally((function(){l(!1)})),N!==S){De.unsubscribe();var i=r.fields.filter((function(e){return"enum"===e.type})).map((function(e){return e.extend.enumId}));i.length&&De.subscribe({context:{enumId:i}},x).catch((function(e){f(e.message)}))}}})),Oe((function(){return function(){_e.unsubscribe(),De.unsubscribe()}}),[]),!!r&&E().createElement(Ne,null,E().createElement(y.Notify,{message:u,onClear:function(){return f(null)}}),E().createElement(y.Chart,{chart:t,dataTable:P}),c&&E().createElement(y.Spinner,null))}Te.displayName="DataChart";var Ie=E().useMemo;function Ae(e){var t=e.field,n=e.value,r=e.changeValue,a=e.disabled,o=t.type,c=t.name,l=t.extend,i=l.caption,s=l.enumId,u=l.isMandatory,f=l.isMultiple,p=l.placeholder,d=Ie((function(){return"enum"===o&&e.enumsValues&&e.enumsValues[s]?function(e,t,n,r){if(t){var a=e[t].map((function(e){return{label:e.label,value:e.id}}));return n||r?a:[{label:"None",value:0}].concat((0,be.Z)(a))}}(e.enumsValues,s,u,f):[]}),[e.enumsValues,s,u,f]);return E().createElement(yn,{disabled:a,key:c,title:i,type:o,isMandatory:u,isMultiple:f,placeholder:p,options:"enum"===o?d:t.options,value:n,changeValue:r})}Ae.displayName="FieldProperty";var qe=n(9734),Be=n.n(qe);const Fe=window.moment;var Me=n.n(Fe),Re=n(4184),Le=n.n(Re);function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ze=y.Tabs.Contents,We=y.Tabs.Tag,He=y.Tabs.Page,Je=E().useState,Ye=E().useContext,Ke=E().useEffect,Ge=E().useMemo,$e=E().useRef,Xe=E().useCallback,Qe="fortressdb-component-data-table",et=new z("revisions");function tt(e){var t=Je(!1),n=(0,g.Z)(t,2),r=n[0],a=n[1],o=Je(null),c=(0,g.Z)(o,2),l=c[0],i=c[1],s=e.onError,u=void 0===s?function(e){console.error(e),i(e)}:s,p=e.table,d=Je([]),m=(0,g.Z)(d,2),b=m[0],v=m[1],h=Ye(te).state.license,k=Je("current"),O=(0,g.Z)(k,2),x=O[0],N=O[1],S=Je(p.fields||[]),P=(0,g.Z)(S,2),Z=P[0],D=P[1],T=Je({}),I=(0,g.Z)(T,2),A=I[0],q=I[1];function B(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q(Z.reduce((function(n,r){var a=r.name,o=e[a];return Ue(Ue({},n),{},(0,f.Z)({},a,t||void 0===o?void 0!==r.defaultValue?r.defaultValue:_(r.type):o))}),{}))}Ke((function(){D(p.fields.filter((function(e){return!e.extend.isHidden})))}),[p.fields]),Ke((function(){B(e.object||{},e.new)}),[]);var F=$e({updateRevisions:function(e,t){if(t)u(t.message);else{var n=e.rows;v(n)}}}).current;Ke((function(){if(e.object&&e.object.id)return et.subscribe({filter:{order:[j.query.orderBy("id",j.query.DESC)]},context:{tableName:p.tableName,objectId:e.object.id}},F.updateRevisions).catch((function(e){u(e.message)})),function(){et.unsubscribe()}}),[e.object&&e.object.id]);var M=Ye(y.Popup.Context),L=R(),V=Xe((0,w.Z)(C().mark((function t(){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a(!0),t.prev=1,!e.new){t.next=7;break}return t.next=5,e.endpoint.post([A]);case 5:t.next=9;break;case 7:return t.next=9,e.endpoint.put([A]);case 9:M(),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),u(t.t0.message),a(!1);case 16:case"end":return t.stop()}}),t,null,[[1,12]])}))),[A,M]),U=Ge((function(){return Be()(Z.filter((function(e){return!e.extend.isHidden})),"extend.order")}),[Z]),z=Xe((function(e,t){q(Ue(Ue({},A),{},(0,f.Z)({},e,t)))}),[Z,A]),W=Ge((function(){return U.filter((function(e){return!e.extend.isSystem}))}),[U]),H=Ge((function(){return U.filter((function(e){return e.extend.isSystem}))}),[U]),J=Ge((function(){return!!h.resources&&h.resources.find((function(e){return"revisions"===e.name})).allow}),[h]),Y=[{value:"current",label:L("current")}].concat((0,be.Z)(b.map((function(e){var t=e.updatedAt;return{value:t,label:b.some((function(e){return Me()(e.updatedAt).format("DD MMM YYYY")===Me()(t).format("DD MMM YYYY")}))?Me()(t).format("DD MMM YYYY, hh:mm:ss"):Me()(t).format("DD MMM YYYY")}}))));return E().createElement(le,{type:"col relative",className:Le()("".concat(Qe,"__object-fields"),"fortressdb-form","fortressdb-form-fields")},E().createElement(y.Notify,{wide:!0,message:l,onClear:function(){return i(null)}}),E().createElement(y.Tabs.Component,{defaultTab:"custom"},E().createElement(ze,null,E().createElement(We,{tabId:"custom"},L("custom-fields")),E().createElement(We,{tabId:"system"},L("system-fields"))),E().createElement(He,{tabId:"custom",className:"fortressdb-form-fields-tab"},W.length?W.map((function(t){return E().createElement(Ae,{enumsValues:e.enumsValues||{},key:t.name,field:t,value:A[t.name],changeValue:function(e){return z(t.name,e)}})})):E().createElement(y.Empty,{message:L("no-fields")})),E().createElement(He,{tabId:"system",className:"fortressdb-form-fields-tab"},H.map((function(e){return E().createElement(Ae,{field:e,key:e.name,disabled:!0,value:A[e.name],changeValue:function(t){return z(e.name,t)}})})))),E().createElement(le,{type:"row",className:"fortressdb-form-controls"},E().createElement(y.Button,{onClick:V,disabled:e.disabled},L("save")),E().createElement(y.Button,{onClick:M},L("cancel")),J&&!e.new&&b.length?E().createElement(le,{type:"row flex align right",className:"".concat(Qe,"__object-fields-revisions")},E().createElement(y.Select,{options:Y,value:Y.find((function(e){return e.value===x})),onChange:function(t){var n=t.value;N(n),B("current"!==n?b.find((function(e){return e.updatedAt===n})):Ue({},e.object||{}))}})):null),r&&E().createElement(y.Spinner,null))}tt.displayName="ObjectFields";var nt=E().useState,rt=E().useContext,at=E().useCallback;function ot(e){var t=nt(!1),n=(0,g.Z)(t,2),r=n[0],a=n[1],o=nt(null),c=(0,g.Z)(o,2),l=c[0],i=c[1],s=rt(y.Popup.Context),u=R(),f=at((0,w.Z)(C().mark((function t(){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(!0),t.prev=1,t.next=4,e.endpoint.delete({where:{id:e.selected}});case 4:s(),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(1),i(t.t0.message),a(!1);case 11:case"end":return t.stop()}}),t,null,[[1,7]])}))),[]),p=e.selected.map((function(t){var n=e.objects.find((function(e){return e.id===t}));return n?"ID=".concat(n.id):""})).filter((function(e){return!!e})).join(", ");return E().createElement(le,{type:"col relative",className:"fortressdb-form"},E().createElement(y.Notify,{message:l,onClear:function(){return i(null)}}),E().createElement(le,{type:"row"},u("confirm-remove-selected-objects"),E().createElement("span",{style:{marginLeft:"0.5em"}},"[ ",p," ]")),E().createElement(le,{type:"row",className:"fortressdb-form-controls"},E().createElement(y.Button,{onClick:f,disabled:e.disabled},u("confirm")),E().createElement(y.Button,{onClick:s},u("cancel"))),r&&E().createElement(y.Spinner,null))}ot.displayName="ObjectRemove";var ct=n(3671);function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var st=E().useState,ut=E().useContext,ft=E().useCallback,pt=E().useEffect,dt=E().useMemo,mt="fortressdb-component-data-table";function bt(e){var t=e.table,n=st(!1),r=(0,g.Z)(n,2),a=r[0],o=r[1],c=st(null),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=st(null),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=st(""),b=(0,g.Z)(m,2),v=b[0],h=b[1],k=st(","),O=(0,g.Z)(k,2),x=O[0],N=O[1],j=st([]),S=(0,g.Z)(j,2),P=S[0],Z=S[1],_=st(!0),D=(0,g.Z)(_,2),T=D[0],I=D[1],A=st(!1),q=(0,g.Z)(A,2),B=q[0],M=q[1],L=st([]),V=(0,g.Z)(L,2),U=V[0],z=V[1],W=ut(y.Popup.Context),H=R(),J=ft((0,w.Z)(C().mark((function e(){var n,r,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.prev=1,n=t.tableName,r=U.reduce((function(e,t){return e[t.id]=t.index,e}),{}),a=p&&Array.isArray(p)?p[0]:p,e.next=7,F.W.post("objects-import",{context:{tableName:n},data:[{fieldsMapping:r,delimiter:x,clearTable:B,hasHeader:T,file:a}]});case 7:W(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),s(e.t0.message),o(!1);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),[t,p,U,x,T,B]);pt((function(){var e=p&&Array.isArray(p)?p[0]:p;if(e){var t=new FileReader;t.addEventListener("load",(function(e){var t=(e.target.result||"").split("\n")[0].trim(),n=t.indexOf(";")>=0?";":",";h(t),N(n)})),t.readAsText(e.slice(0,Math.min(e.size,1024)))}}),[p]),pt((function(){x&&ct({output:"csv",noheader:!0,delimiter:x}).fromString(v||"").then((function(e){return(e[0]||[]).map((function(e){return e.replace(/^["\s]+|["\s]+$/,"")}))})).then((function(e){var n=e.map((function(e,t){return{value:t,label:"[".concat(t,"] ").concat(e)}}));Z([{value:-1,label:"None"}].concat((0,be.Z)(n))),t&&z(t.fields.filter((function(e){var t=e.extend,n=t.isSystem,r=t.isHidden;return!n&&!r})).sort((function(e,t){return e.extend.order-t.extend.order})).map((function(t){var n=t.name,r=t.extend.caption;return{id:n,caption:r,index:e.findIndex((function(e){return e===r}))}})))}))}),[t,v,x]);var Y=dt((function(){return[{Header:"Column",accessor:"caption"},{Header:"Index",accessor:"index",Cell:function(e){var t=e.original,n=e.value,r=e.index;return E().createElement(y.Select,{options:P,value:P.find((function(e){return e.value===n})),onChange:function(e){var n=(0,be.Z)(U);n.splice(r,1,it(it({},t),{},{index:e.value})),z(n)}})}}]}),[P,U]);return E().createElement(le,{type:"col relative",className:"".concat(mt,"__import-file")},E().createElement(y.Notify,{message:i,onClear:function(){return s(null)}}),a&&E().createElement(y.Spinner,null),E().createElement(le,{type:"col"},E().createElement(le,{type:"col",style:{marginBottom:"4px"}},H("select-file"),E().createElement(nr,{field:{type:"file",value:p},changeValue:d,acceptFiles:".csv, text/csv"})),E().createElement(le,{type:"row",style:{marginBottom:"4px"}},E().createElement(le,{type:"col"},H("delimiter"),E().createElement(y.Input,{value:x,onChange:function(e){var t=e.target.value;N(t)},maxLength:1,style:{width:"4em"}})),E().createElement(le,{type:"col flex align bottom",style:{marginLeft:"2em"}},E().createElement(le,{type:"row",style:{marginBottom:"4px"}},E().createElement(y.Input,{type:"checkbox",checked:T,onChange:function(e){var t=e.target.checked;I(t)}}),H("has-header")),E().createElement(le,{type:"row"},E().createElement(y.Input,{type:"checkbox",checked:B,onChange:function(e){var t=e.target.checked;M(t)}}),H("clear-table")))),E().createElement(le,{type:"col"},E().createElement("b",null,H("map-columns")),E().createElement(y.Table,{data:U,columns:Y,pageSize:U.length||5,filterable:!1,sortable:!1,showPagination:!1,manual:!1}))),E().createElement("div",{className:"".concat(mt,"__popup-buttons")},E().createElement(y.Button,{onClick:J,disabled:e.disabled||!p||!x},H("upload")),E().createElement(y.Button,{onClick:W},H("cancel"))))}function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}bt.displayName="ImportFile";var gt=E().useState,ht=E().useContext,Et=E().useCallback;function wt(e){var t=e.table,n=e.filter,r=gt(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=gt(null),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=gt(","),p=(0,g.Z)(f,2),d=p[0],m=p[1],b=gt("utf8"),v=(0,g.Z)(b,2),h=v[0],k=v[1],O=gt(!1),x=(0,g.Z)(O,2),N=x[0],j=x[1],S=ht(y.Popup.Context),P=R(),Z=Et((0,w.Z)(C().mark((function e(){var r,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.prev=1,e.next=4,new Promise((function(e,r){F.W.once("exportFinished",(function(t,n){n("OK"),e(t)}));var a=yt({attributes:t.fields.filter((function(e){return!e.extend.isHidden})).sort((function(e,t){return e.extend.order-t.extend.order})).map((function(e){var t=e.name,n=e.type,r=e.extend.caption;return{column:"enum"!==n?t:"".concat(t,"_label"),alias:r}}))},N&&n||{});delete a.limit,delete a.offset,F.W.get("objects-export",{context:{tableName:t.tableName,extendByEnums:!0},filter:a,options:{delimiter:d,encoding:h}})}));case 4:if(r=e.sent,!(a=r.uuid)){e.next=11;break}return e.next=9,(0,D.S)({uuid:a},"".concat(t.name,".csv"),!0);case 9:e.next=12;break;case 11:throw new Error(r.message);case 12:S(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),u(e.t0.message),c(!1);case 19:case"end":return e.stop()}}),e,null,[[1,15]])}))),[t,n,d,N,h]);return E().createElement(le,{type:"col relative"},E().createElement(y.Notify,{message:s,onClear:function(){return u(null)}}),o&&E().createElement(y.Spinner,null),E().createElement(le,{type:"col"},E().createElement(le,{type:"row"},E().createElement(y.Input,{type:"checkbox",checked:N,onChange:function(e){var t=e.target.checked;j(t)}}),P("use-filter")),E().createElement(le,{type:"row",style:{marginBottom:"4px"}},E().createElement(le,{type:"col"},P("delimiter"),E().createElement(y.Input,{value:d,onChange:function(e){var t=e.target.value;m(t)},maxLength:1,style:{width:"4em"}})),E().createElement(le,{type:"col",style:{marginLeft:"2em"}},P("encoding"),E().createElement(y.Input,{value:h,onChange:function(e){var t=e.target.value;k(t)},maxLength:1,style:{width:"4em"}})))),E().createElement("div",{className:"".concat("fortressdb-component-data-table","__popup-buttons")},E().createElement(y.Button,{onClick:Z,disabled:e.disabled||o},P("download")),E().createElement(y.Button,{onClick:S},P("cancel"))))}wt.displayName="ExportFile";var kt=[5,10,15,20,50,100],Ot=[{id:"id",desc:!1}];function xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ct={Cell:void 0,Filter:void 0,Header:"",id:void 0,width:200};function jt(e){var t=e.value;return React.createElement("div",null,Object.keys(t).map((function(e){return React.createElement("div",{key:e}," ",e+" : "+t[e]," ")})))}jt.displayName="termRenderer";var St=function e(){(0,p.Z)(this,e)};St.prefix="search_",St.tableColumns=[Nt(Nt({},Ct),{},{Header:"Id",id:"id",accessor:"id",width:60}),Nt(Nt({},Ct),{},{Header:"Search term",id:"searchTerm",accessor:function(e){return e.searchTerm},Cell:jt,width:400}),Nt(Nt({},Ct),{},{Header:"Count",id:"count",accessor:"count"}),Nt(Nt({},Ct),{},{Header:"Created At",id:"createdAt",accessor:function(e){return new Date(e.createdAt).toLocaleDateString()+" "+new Date(e.createdAt).toLocaleTimeString()}}),Nt(Nt({},Ct),{},{Header:"Updated At",id:"updatedAt",accessor:function(e){return new Date(e.updatedAt).toLocaleDateString()+" "+new Date(e.updatedAt).toLocaleTimeString()}})],St.metadata={tableName:"Search history",fields:St.tableFields=[{name:"id",type:"integer"},{name:"searchTerm",type:"json"},{name:"count",type:"integer"},{name:"createdAt",type:"datetime"},{name:"updatedAt",type:"datetime"}]};const Pt=St;function Zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dt=E().useCallback,Tt=E().useState,It=E().useEffect,At=E().useContext,qt=E().useMemo,Bt=E().useRef,Ft=E().Fragment,Mt="fortressdb-component-data-table",Rt=/([><=!]+)[\s]*?|([-]?\d+[.,]?\d?)[\s]*?|([|&]+|and|or)/g,Lt={"=":"=","!=":"!=","<>":"!=","<":"<","<=":"<=",">":">",">=":">="},Vt="or",Ut="and",zt={or:Vt,"|":Vt,"||":Vt,and:Ut,"&":Ut,"&&":Ut};function Wt(e,t){var n=e.page,r=e.pageSize,a=e.sorted,o=void 0===a?[]:a,c=e.filtered,l=void 0===c?[]:c,i=t.fields,s={order:o.reduce((function(e,t){var n=t.id,r=t.desc,a=i.find((function(e){return e.name===n}));if(!a)return e;if(a){switch(a.type){case"json":return e.push(j.query.orderBy(j.query.fn("coalesce",j.query.fn("cast",n,j.query.lit("text")),j.query.val("")),r?j.query.DESC:j.query.ASC)),e}e.push(j.query.orderBy(n,r?j.query.DESC:j.query.ASC))}return e}),[]),limit:r,offset:n*r};if(l.length){var u=l.reduce((function(e,t){var n=t.id,r=t.value,a=i.find((function(e){return e.name===n}));if(!a)return e;if(a){switch(a.type){case"string":case"text":return e.push(j.query.op("iLike",n,j.query.val("%".concat(r,"%")))),e;case"integer":case"float":return e.push(function(e,t){var n=(0,be.Z)(t.matchAll(Rt)).map((function(e){return e[0]}));if(n.length){var r=n.map((function(e,t){var n=Lt[e];return n?{type:"math",operator:n,index:t}:(n=zt[e])?{type:"logic",operator:n,index:t}:{type:"number",number:+e.replace(",","."),index:t}}));if(1===r.length&&"number"===r[0].type)return j.query.op("iLike",j.query.fn("coalesce",j.query.fn("cast",e,j.query.lit("text")),j.query.val("")),j.query.val("%".concat(r[0].number,"%")));if(2===r.length&&"math"===r[0].type&&"number"===r[1].type)return j.query.op(r[0].operator,e,j.query.val(r[1].number));var a=r.filter((function(e){return"logic"===e.type})).filter((function(e){return e.operator===Vt})).reduce((function(e,t,n,a){return 0===n?e.push(r.slice(0,t.index)):e.push(r.slice(a[n-1].index+1,t.index)),n===a.length-1&&e.push(r.slice(t.index+1)),e}),[]).filter((function(e){return e.length>=2}));if(a.length)return j.query.op.apply(j.query,["or"].concat((0,be.Z)(a.map((function(t){if(2===t.length&&"math"===t[0].type&&"number"===t[1].type)return j.query.op(t[0].operator,e,j.query.val(t[1].number));var n=t.filter((function(e){return e.operator===Ut})).reduce((function(e,n,r,a){var o=t.indexOf(n);return 0===r?e.push(t.slice(0,o)):e.push(t.slice(t.indexOf(a[r-1])+1,o)),r===a.length-1&&e.push(t.slice(o+1)),e}),[]).filter((function(e){return 2===e.length&&"math"===e[0].type&&"number"===e[1].type}));return n.length?j.query.op.apply(j.query,["and"].concat((0,be.Z)(n.map((function(t){return j.query.op(t[0].operator,e,j.query.val(t[1].number))}))))):void 0})))));var o=r.filter((function(e){return e.operator===Ut})).reduce((function(e,t,n,a){var o=r.indexOf(t);return 0===n?e.push(r.slice(0,o)):e.push(r.slice(r.indexOf(a[n-1])+1,o)),n===a.length-1&&e.push(r.slice(o+1)),e}),[]).filter((function(e){return 2===e.length&&"math"===e[0].type&&"number"===e[1].type}));if(o.length)return j.query.op.apply(j.query,["and"].concat((0,be.Z)(o.map((function(t){return j.query.op(t[0].operator,e,j.query.val(t[1].number))})))))}return j.query.op("iLike",j.query.fn("coalesce",j.query.fn("cast",e,j.query.lit("text")),j.query.val("")),j.query.val("%".concat(t,"%")))}(n,r)),e;case"date":case"datetime":return e.push(j.query.op("iLike",j.query.fn("coalesce",j.query.fn("to_char",n,j.query.val("DD/MM/YYYY HH24:MI:SS")),j.query.val("")),j.query.val("%".concat(r,"%")))),e;case"enum":return null!==r?e.push(j.query.op("contains",n,j.query.val(r))):e.push(j.query.op("=",n,j.query.val("{}"))),e}e.push(j.query.op("iLike",j.query.fn("coalesce",j.query.fn("cast",n,j.query.lit("text")),j.query.val("")),j.query.val("%".concat(r,"%"))))}return e}),[]);u.length&&(s.where=1===u.length?u[0]:j.query.op.apply(j.query,["and"].concat((0,be.Z)(u))))}return s}function Ht(e){var t=e.value;return E().createElement(le,{type:"row flex align horizontal"},E().createElement(y.Input,{type:"checkbox",checked:t,disabled:!0}),E().createElement(le,{type:"absolute fill",style:{top:0,left:0}}))}Ht.displayName="booleanLabel";var Jt=new z("objects"),Yt=new z("enum_values"),Kt=new z("searches");function Gt(e){var t=e.defaultPageSize,n=void 0===t?15:t,r=e.table,a=e.columns,o=e.searchHistory,c=Tt(!1),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=Tt(null),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=Tt(!1),b=(0,g.Z)(m,2),v=b[0],h=b[1],w=Tt([]),k=(0,g.Z)(w,2),O=k[0],x=k[1],N=Tt({}),C=(0,g.Z)(N,2),S=C[0],_=C[1],D=Tt([]),T=(0,g.Z)(D,2),I=T[0],A=T[1],q=Tt(!1),B=(0,g.Z)(q,2),F=B[0],M=B[1],V=qt((function(){return{sorted:Ot,filtered:[],pageSize:n,page:0}}),[n]),z=Tt(V),W=(0,g.Z)(z,2),H=W[0],J=W[1],Y=Tt(null),K=(0,g.Z)(Y,2),G=K[0],$=K[1],X=At(te).state.options,Q=Dt((function(){h(!1)}),[]),ee=R(),ne=Bt({filterTimeout:0,objectsCount:0,forceCount:!1,updateSearches:function(e,t){t?d(t.message):ae(e)}}).current,re=L(r),ae=Dt((function(e,t){if(t)d(t.message);else{var n=e.count,r=e.rows;x(r),ne.objectsCount=n,d(null)}}),[]),oe=(r||{}).tableName,ce=qt((function(){return e=ne.objectsCount,0===(t=H.pageSize)?1:Math.max(1,Math.ceil(e/t));var e,t}),[ne.objectsCount,H.pageSize]);It((function(){H.page>=ce&&J(_t(_t({},H),{},{filtered:(0,be.Z)(H.filtered),page:ce-1}))}),[ce,H]),It((function(){ne.pageJumpState&&ne.pageJumpState(H.page)}),[H.page]);var ie=qt((function(){return r&&r.tableName===(re||{}).tableName?H:V}),[H,oe]),se=qt((function(){return r&&r.tableName===(re||{}).tableName?O:[]}),[O,oe]),ue=(L(ie),Dt((function(e,t){t?d(t.message):(_(Object.keys(e).reduce((function(t,n){return t[n]=e[n].rows,t}),{})),d(null))}),[])),fe=qt((function(){var e=X||{},t=e.isAdmin,n=e.permissions,r=e.userRoles,a=(n||{})[oe],o={};return a?r.forEach((function(e){var t=a[e];t&&(o=_t(_t({},o),t))})):t&&(o={create:!0,read:!0,update:!0,delete:!0}),o}),[X,oe]),pe=U(),de=pe.setTimeout,me=pe.clearTimeout;It((function(){if(r&&ie&&!o)return s(!0),Jt.subscribe({context:{tableName:oe},filter:_t({},Wt(ie,r)),searchQuery:!!ie.filtered.length},ae,ne.forceCount).catch((function(e){d(e.message)})).finally((function(){s(!1)})),ne.forceCount=!1,function(){Jt.unsubscribe()}}),[r,ie]),It((function(){if(r&&!o){var e=r.fields.filter((function(e){return"enum"===e.type})).map((function(e){return e.extend.enumId}));if(e.length)return Yt.subscribe({context:{enumId:e}},ue).catch((function(e){d(e.message)})),function(){Yt.unsubscribe()}}}),[r]),It((function(){if(r&&o)return s(!0),Kt.subscribe({filter:_t({order:[j.query.orderBy("id",j.query.ASC)]},Wt(ie,Pt.metadata)),context:{tableName:oe}},ne.updateSearches,ne.forceCount).catch((function(e){d(e.message)})).finally((function(){s(!1)})),ne.forceCount=!1,function(){Kt.unsubscribe()}}),[r,ie]);var ye=I[0]||0,ge=se&&ye?se.find((function(e){return e.id===ye})):void 0,he=Dt((function(){h("OBJECT_CREATE")}),[]),Ee=Dt((function(){h("OBJECT_EDIT")}),[]),we=Dt((function(){h("OBJECT_REMOVE")}),[]),ke=Dt((function(){h("IMPORT_FILE")}),[]),Oe=Dt((function(){h("EXPORT_FILE")}),[]);It((function(){F&&(ge&&Ee(),M(!1))}),[ge,F]);var xe=Dt((function(e){return function(t){var n=t[e.name];switch(e.type){case"enum":var r=n?Array.isArray(n)?n:[n]:[],a=S[e.extend.enumId]||[];return r.map((function(e){return(a.find((function(t){return t.id===e}))||{}).label||e})).join(", ");case"datetime":return E().createElement(Ft,null,n?E().createElement(y.Input,{disabled:!0,type:"datetime-local",value:P(n),onChange:function(){}}):"",E().createElement(le,{type:"absolute fill",style:{top:0,left:0}}));case"date":return E().createElement(Ft,null,n?E().createElement(y.Input,{disabled:!0,type:"date",value:String(n).split("T")[0],onChange:function(){}}):"",E().createElement(le,{type:"absolute fill",style:{top:0,left:0}}));case"time":return E().createElement(Ft,null,E().createElement(y.Input,{disabled:!0,type:"time",value:Z(n),onChange:function(){}}),E().createElement(le,{type:"absolute fill",style:{top:0,left:0}}));case"boolean":return!!n;case"file":var o=n?Array.isArray(n)?n:[n]:[];return(o.length>1?"[".concat(o.length,"] "):"")+o.reduce((function(e,t,n){var r=t.name;return"".concat(e).concat(n>0?", ":"").concat(r)}),"")}return"object"===(0,ve.Z)(n)?JSON.stringify(n):String(n)}}),[S]),Ne=qt((function(){var e=a&&Array.isArray(a);return o?Pt.tableColumns:function(e){return r?Be()(r.fields,"extend.order").filter((function(t){return!t.extend.isHidden&&(!e||a.indexOf(t.name)>=0)})).map((function(e){return _t(_t({Header:e.extend.caption,id:e.name,accessor:xe(e)},"id"===e.name?{width:60}:{}),{},{Cell:"boolean"===e.type?Ht:void 0,Filter:"enum"!==e.type?void 0:function(){var t=H.filtered.find((function(t){return t.id===e.name})),n=[{value:null,label:"- ".concat(ee("no-value")," -")}].concat((0,be.Z)((S[e.extend.enumId]||[]).map((function(e){return{value:e.id,label:e.label}})))),r=t&&t.value,a=void 0!==r&&(null===r?[null]:r).map((function(e){return n.find((function(t){return t.value===e}))}));return E().createElement(y.Select,{options:n,isSearchable:!1,isClearable:!0,isMulti:!1,value:a&&a[0],onChange:function(n){var r=_t(_t({},H),{},{filtered:(0,be.Z)(H.filtered)}),a=r.filtered.indexOf(t);if(a>=0&&r.filtered.splice(a,1),n){var o=Array.isArray(n)?n.map((function(e){return e.value})):[n.value],c=null===o[o.length-1];r.filtered.push({id:e.name,value:c?null:o.filter((function(e){return e}))})}J(r)}})}()})})):[]}(e)}),[r,S,H,a]),Ce=Dt((function(e,t){A(e),M(t)}),[]);if(!r)return E().createElement(y.Empty,null);var je=!fe.read,Se=!fe.create,Pe=!fe.update,Ze=!fe.delete;return E().createElement("div",{className:Mt},E().createElement(y.Notify,{message:p,onClear:function(){return d(null)}}),E().createElement(y.Popup.Switcher,{active:v,onClose:Q},E().createElement(tt,{popup:{id:"OBJECT_CREATE",title:ee("create-object")},endpoint:Jt,enumsValues:S,table:r,new:!0,disabled:Se}),E().createElement(tt,{popup:{id:"OBJECT_EDIT",title:ee("edit-object")},endpoint:Jt,enumsValues:S,object:ge,table:r,disabled:Pe}),E().createElement(ot,{popup:{id:"OBJECT_REMOVE",title:ee("remove-objects")},endpoint:Jt,selected:I,objects:se,disabled:Ze}),E().createElement(bt,{popup:{id:"IMPORT_FILE",title:ee("import-file")},table:r}),E().createElement(wt,{popup:{id:"EXPORT_FILE",title:ee("export-file")},table:r,filter:(Jt.options||{}).filter||{}})),!o&&E().createElement("div",{className:"".concat(Mt,"__toolbar")},E().createElement("div",{className:"".concat(Mt,"__toolbar-buttons")},E().createElement(y.Button,{onClick:he,disabled:Se,icon:"add",title:ee("add-object")}),E().createElement(y.Button,{onClick:Ee,disabled:Pe||!ge,icon:"edit",title:ee("edit-object")}),E().createElement(y.Button,{onClick:we,disabled:Ze||!I.length,icon:"delete",title:ee("remove-objects")}),E().createElement(y.Button,{onClick:ke,disabled:Se||Pe||Ze,icon:"upload",title:ee("import-file")}),E().createElement(y.Button,{onClick:Oe,disabled:je,icon:"download",title:ee("export-file")})),E().createElement("div",{className:"".concat(Mt,"__title")},r.name)),E().createElement(y.Table,{key:oe,data:se,pages:ce,page:ie.page,onPageChange:function(e){ne.forceCount=ne.objectsCount,J(_t(_t({},H),{},{page:e}))},sorted:ie.sorted,onSortedChange:function(e){ne.forceCount=ne.objectsCount,J(_t(_t({},H),{},{sorted:e}))},filtered:G||ie.filtered,onFilteredChange:function(e){$(e),ne.filterTimeout&&(me(ne.filterTimeout),ne.filterTimeout=0);var t=/\s*[><=!]+\s*\d+|[^><=!\s]+/;e.every((function(e){var n=e.value;return n&&"string"==typeof n?t.test(n):n}))&&(ne.filterTimeout=de((function(){$(null),ne.filterTimeout=0,J(_t(_t({},H),{},{filtered:e,page:0}))}),500))},pageSize:ie.pageSize,onPageSizeChange:function(e,t){ne.forceCount=ne.objectsCount,J(_t(_t({},H),{},{pageSize:e,page:t}))},columns:Ne,onSelect:Ce,pageSizeOptions:kt,renderPageJump:function(e){var t=e.onChange,n=e.onBlur,r=e.value,a=e.onKeyPress,o=e.inputType,c=e.pageJumpText;return ne.pageJumpState=function(e){t({target:{value:e+1},preventDefault:function(){}})},E().createElement("div",{className:"-pageJump"},E().createElement("input",{"aria-label":c,type:o,onChange:t,value:r,onBlur:n,onKeyPress:a}))}}),i&&E().createElement(y.Spinner,null))}Gt.displayName="DataTable";var $t={Component:Gt,PAGE_SIZE_OPTIONS:kt,DEFAULT_PAGE_SIZE:15,DEFAULT_SORTED:Ot},Xt=E().useState,Qt=E().useContext,en=E().useCallback;function tn(e){var t=R(),n=e.onConfirm,r=void 0===n?(0,w.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))):n,a=e.onError,o=void 0===a?(0,w.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))):a,c=e.confirmText,l=void 0===c?t("save"):c,i=e.cancelText,s=void 0===i?t("cancel"):i,u=Xt(!1),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=Xt(null),b=(0,g.Z)(m,2),v=b[0],h=b[1],k=Qt(y.Popup.Context),O=en(function(){var e=(0,w.Z)(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),d(!0),e.prev=2,e.next=5,r();case 5:k(),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,o(e.t0);case 12:h(e.t0.message),d(!1);case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[r,o]);return E().createElement(le,{type:"col relative",className:"fortressdb-form"},E().createElement(y.Notify,{message:v,onClear:function(){return h(null)}}),e.children,E().createElement(le,{type:"row",className:"fortressdb-form-controls"},E().createElement(y.Button,{onClick:O},l),E().createElement(y.Button,{onClick:k},s)),p&&E().createElement(y.Spinner,null))}tn.displayName="PopupBasicForm";var nn=E().useState,rn=E().useCallback;function an(e){var t=R(),n=e.data,r=void 0===n?{}:n,a=e.disabled,o=void 0!==a&&a,c=e.propertyTitle,l=void 0===c?t("name"):c,i=nn(r.name||""),s=(0,g.Z)(i,2),u=s[0],f=s[1],p=rn((0,w.Z)(C().mark((function t(){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.action({name:u}));case 1:case"end":return t.stop()}}),t)}))),[u]);return E().createElement(tn,{onConfirm:p,confirmText:e.confirmText},E().createElement(yn,{autoFocus:!0,disabled:o,title:l,type:"string",value:u,changeValue:f}))}an.displayName="NameForm";var on=E().Fragment,cn="fortressdb-component-page-header";function ln(e){return E().createElement(on,null,E().createElement("div",{alt:"logo",className:"".concat(cn,"__logo")}),e.title&&E().createElement("div",{className:"".concat(cn,"__logo-title")},e.title))}ln.displayName="Logo";var sn="fortressdb-component-page-header";function un(e){return E().createElement("div",{className:sn},E().createElement(ln,{title:e.title}),E().createElement("div",{className:"".concat(sn,"__body")},e.children))}un.displayName="PageHeader";var fn=E().useCallback,pn="fortressdb-component-page-header";function dn(e){var t=e.className,n=e.onClick,r=e.disabled,a=fn((function(){r||n()}),[n,r]);return E().createElement("div",{className:Le()("".concat(pn,"__button"),r&&"".concat(pn,"__button_disabled"),t),onClick:a},E().createElement(y.Icon,{icon:e.icon,color:"white"}),e.children)}function mn(e){return E().createElement("div",{className:"".concat("fortressdb-component-page-header","__buttons")},e.children)}dn.displayName="PageHeaderButton",mn.displayName="PageHeaderButtons";var bn={Component:un,Buttons:mn,Button:dn},vn="fortressdb-component-property";function yn(e){var t=e.autoFocus,n=e.title,r=e.disabled,a=void 0!==r&&r,o=e.options,c=void 0===o?[]:o,l=e.type,i=e.isMandatory,s=e.isMultiple,u=e.value,f=e.placeholder,p=e.defaultValue,d=e.changeValue,m=e.reverseOrder,b=void 0!==m&&m,v="checkbox"===e.type||"boolean"===e.type;return E().createElement("div",{className:Le()(vn,v&&(b&&"".concat(vn,"_checkbox-reverse")||"".concat(vn,"_checkbox")))},E().createElement("div",{className:Le()("".concat(vn,"__title"),i&&"".concat(vn,"__title_mandatory"))},n),E().createElement(nr,{autoFocus:t,disabled:a,title:n,field:{type:l,value:u,isMandatory:i,isMultiple:s,placeholder:f},options:c,defaultValue:p,changeValue:d}))}yn.displayName="Property";var gn=E().useCallback,hn=E().useState,En=E().useEffect,wn=E().useContext,kn=E().useRef,On=new z("enums");function xn(e){var t=e.onFetching,n=void 0===t?function(){}:t,r=e.onError,a=void 0===r?function(){}:r,o=e.defaultSelected,c=hn(!1),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=hn([]),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=wn(te),b=m.state.enums,v=m.dispatch,h=(b||{}).current,w=kn({dispatchCurrentEnum:function(e){v({enums:{current:e,watcher:On}})},updateEnumsValues:function(e,t){if(t)a(t.message);else{var n=e.rows;d(n)}},enums:p}).current,k=gn((function(e){var t=e.value;h&&h.id!==t&&w.dispatchCurrentEnum(p.find((function(e){return e.id===t})))}),[p,h]);En((function(){if(h)if(p.length){if(w.enums!==p){var e=h.id;w.dispatchCurrentEnum(p.find((function(t){return t.id===e})))}}else w.dispatchCurrentEnum(void 0);w.enums=p}),[p,h]),En((function(){p.length&&!h&&w.dispatchCurrentEnum(o&&p.find((function(e){return e.id===o}))||p[0])}),[p,h,o]),En((function(){return s(!0),n(!0),w.dispatchCurrentEnum(null),On.subscribe({filter:{}},w.updateEnumsValues).catch((function(e){a(e.message)})).finally((function(){s(!1),n(!1)})),function(){On.unsubscribe(),v({enums:void 0})}}),[]);var O=R(),x=i?[]:p.length?p.map((function(e){return{value:e.id,label:e.name}})):[{value:-1,label:O("no-items")}],N=p.length?(h||{}).id:-1,C=x.find((function(e){return e.value===N}));return E().createElement("div",{className:"fortressdb-component-select-picklist"},E().createElement(y.Select,{options:x,value:C,isDisabled:i||0===p.length,onChange:k}),i&&E().createElement(y.Spinner,{small:!0}))}function Nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xn.displayName="SelectPicklist";var jn=E().useCallback,Sn=E().useState,Pn=E().useEffect,Zn=E().useContext,_n=E().useRef,Dn=new z("metadata");function Tn(e){var t=e.onFetching,n=void 0===t?function(){}:t,r=e.onError,a=void 0===r?function(){}:r,o=e.defaultSelected,c=e.selectForms,l=void 0===c?"all":c,i=Sn(!1),s=(0,g.Z)(i,2),u=s[0],f=s[1],p=Sn([]),d=(0,g.Z)(p,2),m=d[0],b=d[1],v=Zn(te),h=v.state.tables,w=v.dispatch,k=(h||{}).current,O=_n({dispatchCurrentTable:function(e){w({tables:{current:e,watcher:Dn}})},updateMetadata:function(e,t){if(t)a(t.message);else{var n=e.rows;b(n)}},metadata:m}).current,x=jn((function(e){var t=e.value;k&&k.id!==t&&O.dispatchCurrentTable(m.find((function(e){return e.id===t})))}),[m,k]);Pn((function(){if(k)if(m.length){if(O.metadata!==m){var e=k.id;O.dispatchCurrentTable(m.find((function(t){return t.id===e})))}}else O.dispatchCurrentTable(void 0);O.metadata=m}),[m,k]),Pn((function(){m.length&&!k&&O.dispatchCurrentTable(o&&m.find((function(e){return e.tableName===o}))||m[0])}),[m,k,o]),Pn((function(){return f(!0),n(!0),O.dispatchCurrentTable(null),Dn.subscribe({filter:Cn({order:[j.query.orderBy("name")]},"all"===l?{}:{where:j.query.op("secure"===l?"?":"!?",j.query.fn("cast","options",j.query.lit("jsonb")),j.query.val("source"))})},O.updateMetadata).catch((function(e){a(e.message)})).finally((function(){f(!1),n(!1)})),function(){Dn.unsubscribe(),w({tables:void 0})}}),[]);var N=R(),C=u?[]:m.length?m.map((function(e){return{value:e.id,label:e.name}})):[{value:-1,label:N("no-items")}],S=m.length?(k||{}).id:-1,P=C.find((function(e){return e.value===S}));return E().createElement("div",{className:"fortressdb-component-select-table"},E().createElement(y.Select,{options:C,value:P,isDisabled:u||0===m.length,onChange:x}),u&&E().createElement(y.Spinner,{small:!0}))}Tn.displayName="SelectTable";var In=n(4140);function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bn=(0,In.W8)((function(e){var t=e.index,n=e.element,r=e.data,a=e.accessorId;return E().cloneElement(n,qn(qn({},r),{},{key:"item-".concat(r[a]),index:t}))})),Fn=(0,In.JN)((function(e){var t=e.items,n=e.footer,r=void 0===n?null:n,a=e.header,o=void 0===a?null:a,c=e.element,l=e.accessorId,i=void 0===l?"id":l,s=e.disabled,u=void 0!==s&&s;return E().createElement("ul",{className:"fortressdb-sortable-list-wrapper"},o,t.map((function(e,t){return E().createElement(Bn,{key:"item-".concat(e[i]),index:t,data:e,element:c,accessorId:i,disabled:u})})),r)}));Fn.displayName="SortableList";var Mn=n(8029),Rn=n.n(Mn),Ln=E().useState,Vn=E().useMemo,Un=E().useEffect,zn=E().useCallback,Wn=E().Fragment,Hn="fortressdb-component-tariff-plan";function Jn(e){var t=e.plan,n=e.planNumber,r=e.readOnly,a=void 0!==r&&r,o=e.disabled,c=void 0!==o&&o,l=e.discount,i=void 0===l?null:l,s=e.licensePlanId,u=e.licenseStatus,f=e.onPay,p=e.upgrade,d=void 0!==p&&p,m=Ln(!1),b=(0,g.Z)(m,2),v=b[0],h=b[1],k=Vn((function(){return(0,be.Z)(t.period||[]).sort((function(e,t){var n=e.name,r=t.name;return n===r?0:n>r?1:-1}))}),[t.period]),O=L(k),x=Ln(s&&k.find((function(e){return e.id===s}))||k[0]),N=(0,g.Z)(x,2),j=N[0],P=N[1];Un((function(){O&&O!==k&&j&&P(k.find((function(e){return e.name===j.name}))||k[0])}),[k,O,j]);var Z=Vn((function(){return S(j.price,i)}),[j,i]),_=Vn((function(){return k.map((function(e){return{value:e,label:Rn()(e.name)}}))}),[k]),D=R(),T=zn((0,w.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=5;break}return h(!0),e.next=4,f(j.id);case 4:h(!1);case 5:case"end":return e.stop()}}),e)}))));return E().createElement(le,{type:"col",className:Le()(Hn,"fortressdb-plan","fortressdb-plan-".concat(t.name))},!!n&&E().createElement("div",{className:Le()("".concat(Hn,"__number"),!1)},n),!!t.tag&&E().createElement(le,{type:"row align horizontal"},E().createElement(le,{type:"col",className:Le()("fortressdb-plan-flag","fortressdb-plan-flag-".concat(t.tag))},t.tag)),E().createElement(le,{type:"row align horizontal",className:"fortressdb-plan-image-wrapper"},E().createElement(le,{type:"col",className:Le()("fortressdb-plan-image","fortressdb-plan-image-".concat(t.name))})),E().createElement(le,{type:"row align horizontal"},E().createElement(le,{type:"col"},E().createElement("h1",{className:"fortressdb-plan-title"},t.name))),E().createElement(le,{type:"row "},E().createElement(le,{type:"col flex",className:"fortressdb-plan-restrictions"},E().createElement(y.OptionsList,{items:t.restrictions.map((function(e){var t=e.name,n=e.caption,r=e.value,a=e.units;return{name:t,value:n?Rn()(n):a?"".concat(r," ").concat(a):r}}))}))),k.length>1&&E().createElement(Wn,null,E().createElement(le,{type:"row align horizontal flex",className:"fortressdb-plan-period"},E().createElement(y.Select,{className:"fortressdb-plan-period-select",options:_,value:_.find((function(e){return e.value===j})),onChange:function(e){var t=e.value;P(t)}})),E().createElement(le,{type:"row align horizontal",className:"fortressdb-plan-cost"},Z!==j.price?E().createElement("span",null,E().createElement(y.Price,{currency:j.units,value:j.price,className:"fortressdb-plan-old-price"}),Z?E().createElement(y.Price,{currency:j.units,value:Z,className:"fortressdb-plan-new-price"}):E().createElement("span",{className:"fortressdb-plan-new-price"},D("for-free"))):E().createElement(y.Price,{currency:j.units,value:j.price})),!a&&E().createElement(le,{type:"row align horizontal flex",className:"fortressdb-plan-upgrade"},E().createElement(y.Button,{disabled:c||j.id===s&&"cancelled"!==u,onClick:T},D(d?"upgrade":"buy")))),v&&E().createElement(y.Spinner,null))}function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Jn.displayName="TariffPlan";var Gn=E().useState,$n=E().useEffect,Xn=E().useCallback,Qn=E().useRef,er="fortressdb-component-type-control",tr=[{size:1e3,label:"KB"},{size:1e6,label:"MB"},{size:1e9,label:"GB"}],nr=(0,y.ErrorBoundary)((function(e){var t=e.disabled,n=e.className,r=e.autoFocus,a=e.changeValue,o=void 0===a?function(){}:a,c=e.field,l=void 0===c?{}:c,i=e.options,s=void 0===i?[]:i,u=e.acceptFiles,f=void 0===u?"*":u,p=l.type,d=l.placeholder,m=void 0===d?"":d,b="enum"===p&&l.isMultiple,v=void 0!==e.defaultValue?e.defaultValue:_(p),h=void 0!==l.value?l.value:v,k=Gn([]),O=(0,g.Z)(k,2),x=O[0],N=O[1],j=Gn(!1),S=(0,g.Z)(j,2),T=S[0],A=S[1],q=V(),B=R();function F(){return(F=(0,w.Z)(C().mark((function e(t){var n;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),e.prev=1,e.next=4,Promise.all(t.map((function(e){return e&&"string"==typeof e.type&&e.type.startsWith("image")?q((0,I.q)(e,"thumb").catch((function(){return null}))):null})));case 4:n=e.sent,N(n),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:A(!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}$n((function(){return function(){x&&URL.revokeObjectURL(x)}}),[x]),$n((function(){"file"===p&&function(e){F.apply(this,arguments)}(h?Array.isArray(h)?h:[h]:[])}),[p,h]);var M=Xn(function(){var e=(0,w.Z)(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),e.next=3,q((0,D.S)(t));case 3:A(!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),L=Xn((function(){if(!s.length)return b?[]:null;if(!b){if(!h)return null;var e=Array.isArray(h)?h[0]:h;return s.find((function(t){return t.value===e}))||s[0]}var t=Array.isArray(h)?h:[h];return s.filter((function(e){return t.includes(e.value)}))}),[h,s,b]),U=Qn(null);switch(p){case"text":return E().createElement(y.Textarea,{autoFocus:r,placeholder:m,className:n,disabled:t,value:null===h?"":h,onChange:function(e){return o(e.target.value)}});case"string":case"uuid":return E().createElement(y.Input,{autoFocus:r,placeholder:m,className:n,disabled:t,value:null===h?"":h,onChange:function(e){return o(e.target.value)}});case"json":return E().createElement(y.Textarea,{autoFocus:r,placeholder:m,className:n,disabled:t,value:null===h?"":"object"===(0,ve.Z)(h)?JSON.stringify(h):h,onChange:function(e){return o(e.target.value)}});case"integer":case"float":return E().createElement(y.Input,{type:"number",autoFocus:r,placeholder:m,className:n,disabled:t,value:h,onChange:function(e){return o(e.target.valueAsNumber)}});case"checkbox":case"boolean":return E().createElement(y.Input,{type:"checkbox",autoFocus:r,className:n,disabled:t,checked:h,onChange:function(e){return o(e.target.checked)}});case"date":return E().createElement(y.Input,{type:"date",autoFocus:r,placeholder:m,className:n,disabled:t,value:h?String(h).split("T")[0]:"",onChange:function(e){var t=e.target.value;o(t&&new Date(t).toISOString())}});case"datetime":return E().createElement(y.Input,{type:"datetime-local",autoFocus:r,placeholder:m,className:n,disabled:t,value:P(h),onChange:function(e){var t=e.target.value;o(t&&new Date(t).toISOString())}});case"time":return E().createElement(y.Input,{type:"time",autoFocus:r,placeholder:m,className:n,disabled:t,value:Z(h),onChange:function(e){var t=e.target.value;if(!t)return o(0);var n=t.split(":"),r=(0,g.Z)(n,2),a=r[0],c=void 0===a?0:a,l=r[1],i=void 0===l?0:l;return o(60*parseInt(c)*60+60*parseInt(i))}});case"select":case"enum":return E().createElement(y.Select,{autoFocus:r,placeholder:m,className:n,isSearchable:!1,isDisabled:t,isMulti:b,isOptionDisabled:function(e){return e.disabled},onChange:function(e){return o(e?"enum"===p?b?e.map((function(e){return e.value})).filter((function(e){return e})):e.value?[e.value]:[]:e.value:b?[]:null)},options:s,value:L(h)});case"file":var z=h?Array.isArray(h)?h:[h]:[];return E().createElement("div",{className:"".concat(er,"_file")},T&&E().createElement(y.Spinner,null),E().createElement(y.Input,{type:"file",inputRef:U,accept:f,onChange:function(e){o([].concat((0,be.Z)(z),(0,be.Z)(e.target.files)))},value:[],multiple:!0,className:"".concat(er,"__file-hidden-input")}),E().createElement("div",{className:"".concat(er,"__file-list")},z.map((function(e,n){var r="string"==typeof e.type&&e.type.startsWith("image"),a=r&&x[n];return E().createElement("div",{key:n,className:"".concat(er,"__file-descriptor")},!!r&&E().createElement("div",{key:n,className:"".concat(er,"__file-preview"),style:Kn({},a?{backgroundImage:"url(".concat(a,")")}:{})}),E().createElement("div",{className:"".concat(er,"__file-info")},E().createElement("div",{className:"".concat(er,"__file-name"),title:e.name},e.name),E().createElement("div",{className:"".concat(er,"__file-size")},function(e){for(var t=tr.length-1;t>=0&&e<tr[t].size;)--t;if(t<0)return"".concat(e,"B");var n=tr[t],r=n.size,a=n.label;return"".concat((10*e/r+.5>>0)/10).concat(a)}(e.size))),E().createElement("div",{className:"".concat(er,"__file-controls")},E().createElement(y.Button,{icon:"delete",title:B("delete"),disabled:t,onClick:function(){var e=(0,be.Z)(z);e.splice(n,1),o(e)}}),!(e instanceof File)&&E().createElement(y.Button,{icon:"download",title:B("download"),onClick:function(){M(e)}})))}))),!t&&E().createElement("div",null,E().createElement(y.Button,{icon:"add",color:"black",title:B("add-file"),onClick:function(e){return U.current.click()}})))}return null})),rr=n(7196),ar=n.n(rr);function or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?or(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):or(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lr,ir=E().Fragment,sr=function(e){lr||(lr=new Promise((function(e){var t=0,n=function(n){(0,m.Z)(c,n);var r,a,o=(r=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,v.Z)(r);if(a){var n=(0,v.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,b.Z)(this,e)});function c(e){var t;return(0,p.Z)(this,c),(t=o.call(this,e)).state={children:{}},t}return(0,d.Z)(c,[{key:"componentDidMount",value:function(){e(this)}},{key:"addChild",value:function(e){var n=this;return new Promise((function(r){n.setState((function(n){var a=n.children,o=++t;return setTimeout((function(){r(o)}),0),{children:cr(cr({},a),{},(0,f.Z)({},o,E().createElement(ir,{key:o},e)))}}))}))}},{key:"removeChild",value:function(e){this.setState((function(t){var n=t.children;if(n[e]){var r=cr({},n);return delete r[e],{children:r}}}))}},{key:"render",value:function(){var e=this.state.children;return E().createElement(ee,{license:!0},Object.keys(e).map((function(t){return e[t]})))}}]),c}(E().Component);n.displayName="Root";var r=document.createElement("div");r.id="fortressdb-blocks-root",document.body.appendChild(r),ar().render(E().createElement(n,null),r)}))),lr=lr.then((function(t){return e(t),t}))},ur=new Promise((function(e){document.addEventListener("DOMContentLoaded",e)}));function fr(e,t){ur=ur.then((function(){for(var n=document.getElementsByClassName(e),r=function(e,r){var a=n[e],o=JSON.parse((a.dataset||{}).attributes||null);sr((function(e){e.addChild(ar().createPortal(E().createElement(t,{attributes:o}),a))}))},a=0,o=n.length;a<o;++a)r(a)}))}function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mr=E().useState,br=E().useContext,vr=E().useCallback,yr=E().useEffect,gr=E().useMemo,hr=E().Fragment,Er="fortressdb-edit-block";function wr(e){var t=e.attributes,n=e.setAttributes,r=mr(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=mr(""),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=br(te).state,p=f.options,d=f.tables,m=(void 0===d?{}:d).current,b=vr((function(e){var t=e.value;n({defaultPageSize:t})}),[]),v=t.defaultPageSize,h=t.tableName,w=t.settings;yr((function(){m&&m.tableName!==h&&n({tableName:m.tableName,settings:dr(dr({},w),{},{columns:m.fields.map((function(e){return e.name}))})})}),[m,h,w]);var k=gr((function(){return $t.PAGE_SIZE_OPTIONS.map((function(e){return{value:e,label:"".concat(e," rows")}}))}),[]),O=vr((function(e,t){var r=(w.columns||[]).filter((function(t){return t!==e}));t&&r.push(e),n({settings:dr(dr({},w),{},{columns:r})})}),[w]),x=gr((function(){if(!m)return[];var e=w.columns||[];return m.fields.filter((function(e){return!e.extend.isHidden})).map((function(t){return{value:t.name,label:E().createElement(le,{type:"row",onClick:function(e){return e.stopPropagation()}},E().createElement(y.Input,{type:"checkbox",checked:e.indexOf(t.name)>=0,onChange:function(e){var n=e.target.checked;O(t.name,n)}}),E().createElement("div",null,t.extend.caption))}}))}),[m,O,w.columns]),N=R(),C=!(!p||!p.connected);return yr((function(){C||u(N("plugin-not-connected"))}),[C]),E().createElement("div",{className:Le()(e.className,Er,"".concat(Er,"_table"),e.isSelected&&"".concat(Er,"_selected"))},o&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:s,onClear:function(){return u(null)}}),E().createElement(le,{type:"row align vertical space between",className:"fortressdb-block-title"},E().createElement(le,null,"Table"),E().createElement(le,{type:"background contain",className:"fortressdb-logo fortressdb-block-logo"})),C&&E().createElement(hr,null,E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Data Source"),E().createElement(le,{type:"row wrap relative"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Table:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(Tn,{defaultSelected:h,onFetching:c,onError:u}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Page size:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:k,value:k.find((function(e){return e.value===v})),onChange:b}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Columns:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:x,value:null,onChange:function(){}})))))),E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Preview"),E().createElement(le,{type:"col relative"},m&&E().createElement($t.Component,{key:v,defaultPageSize:v,table:m,columns:w.columns})))))}function kr(e){return E().createElement("div",{className:"fortressdb-block fortressdb-block_edit fortressdb-block_table"},E().createElement(ee,null,E().createElement(ne,null,E().createElement(wr,e))))}wr.displayName="EditForm",kr.displayName="Edit";var Or="fortressdb-block-table";function xr(e){var t=e.attributes;return E().createElement("div",{className:Or,"data-attributes":JSON.stringify(t)})}xr.displayName="Save";var Nr=E().useContext,Cr=E().useEffect,jr=E().useState,Sr="fortressdb-view-block",Pr=new z("metadata");function Zr(e){var t=e.attributes,n=t.defaultPageSize,r=t.tableName,a=t.settings,o=Nr(te).state.options,c=jr(!1),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=jr(null),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=jr(null),b=(0,g.Z)(m,2),v=b[0],h=b[1],w=(o||{}).connected;Cr((function(){if(r&&w)return s(!0),Pr.subscribe({filter:{where:j.query.op("=","tableName",j.query.val(r))}},(function(e,t){if(t)d(t.message);else{var n=e.rows.find((function(e){return e.tableName===r}));if(!n)throw new Error("Selected table is not found");h(n),d(null)}})).catch((function(e){d(e.message)})).finally((function(){s(!1)})),function(){Pr.unsubscribe()}}),[r,w]);var k=R();return E().createElement("div",{className:"fortressdb-block fortressdb-block_view fortressdb-block_table"},E().createElement(ne,null,E().createElement("div",{className:Le()(e.className,Sr,"".concat(Sr,"_table"))},i&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:p,onClear:function(){return d(null)}}),w?v&&E().createElement($t.Component,{defaultPageSize:n,table:v,columns:a.columns}):E().createElement(y.Notify,{message:k("plugin-not-connected")}))))}function _r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Zr.displayName="View";var Tr=E().useState,Ir=E().useContext,Ar=E().useCallback,qr=E().useEffect,Br=E().useMemo,Fr=E().Fragment,Mr="fortressdb-edit-block",Rr=500,Lr={Line:{xType:["string","number","datetime"],yType:["number"],multiAxis:!0,titles:{chart:!0,vAxis:!0,hAxis:!0}},Area:{xType:["string","number","datetime"],yType:["number"],multiAxis:!0,titles:{chart:!0,vAxis:!0,hAxis:!0}},Column:{xType:["string","number","datetime"],yType:["number"],multiAxis:!0,titles:{chart:!0,vAxis:!0,hAxis:!0}},Pie:{xType:["string"],yType:["number"],multiAxis:!1,titles:{chart:!0}}},Vr=[{name:"Line",className:"LineChart",version:"current",packages:["corechart"],options:{width:"100%",height:Rr}},{name:"Area",className:"AreaChart",version:"current",packages:["corechart"],options:{width:"100%",height:Rr}},{name:"Column",className:"ColumnChart",version:"current",packages:["corechart"],options:{width:"100%",height:Rr}},{name:"Pie",className:"PieChart",version:"current",packages:["corechart"],options:{width:"100%",height:Rr}}],Ur=["string","enum"],zr=["date"],Wr=["integer","float"],Hr={x:"",y:[],order:"",group:""},Jr="None";function Yr(e){var t=e.attributes,n=e.setAttributes,r=Tr(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=Tr(""),i=(0,g.Z)(l,2),s=i[0],u=i[1],p=Ir(te).state,d=p.options,m=void 0===d?{}:d,b=p.tables,v=(void 0===b?{}:b).current,h=t.tableName,w=t.chart,k=t.dataSettings,O=w?Lr[w.name]:null,x=Br((function(){return(e=v)?((e||{}).fields||[]).reduce((function(e,t){var n=function(e){var t=(e||{}).type;switch(!0){case Wr.indexOf(t)>=0:return"number";case Ur.indexOf(t)>=0:return"string";case zr.indexOf(t)>=0:return"datetime"}}(t),r=t.name;return t.extend.isHidden||t.extend.isSystem&&"id"!==r&&"createdAt"!==r||!n||(e[r]=Dr(Dr({},t),{},{chartType:n})),e}),{}):{};var e}),[v]),N=Ar((function(e){var t=Dr({},Vr.find((function(t){return t.name===e})));if(w){var n=Lr[e];t.options=Dr(Dr(Dr(Dr({},t.options),{},{width:w.options.width,height:w.options.height},(n.titles||{}).chart?{title:w.options.title}:{}),(n.titles||{}).vAxis?{vAxis:w.options.vAxis}:{}),(n.titles||{}).hAxis?{hAxis:w.options.hAxis}:{})}return t}),[w]),C=Ar((function(e){var t=Dr({},k),n=Lr[e];return t.x&&n.xType.indexOf((x[t.x]||{}).chartType)<0&&(t.x="",t.order="",t.group=""),t.y=k.y.filter((function(e){return n.yType.indexOf((x[e]||{}).chartType)>=0})),t.y.length>1&&!n.multiAxis&&(t.y=[t.y[0]]),t}),[k,x]);qr((function(){w||n({chart:Dr({},Vr[0])}),k||n({dataSettings:Dr({},Hr)})}),[w,k]),qr((function(){v&&v.tableName!==h&&n({tableName:v.tableName,dataSettings:C((w||{}).name||Vr[0].name)})}),[v,h,k,x,w]);var j=Br((function(){return O&&x?Object.keys(x).filter((function(e){return k.y.indexOf(e)<0&&O.xType.indexOf((x[e]||{}).chartType)>=0})):[]}),[O,x,k]),S=Br((function(){return O&&x?Object.keys(x).filter((function(e){return k.x!==e&&O.yType.indexOf((x[e]||{}).chartType)>=0})):[]}),[O,x,k]),P=Br((function(){if(O&&k){var e=k.y.filter((function(e){return e}));return(0===e.length||O.multiAxis&&S.length-e.length>0)&&e.push(""),e}return[]}),[O,k,S]),Z=Ar((function(e){var t=e.value;n({dataSettings:Dr(Dr({},k),{},{x:t,order:""})})}),[k]),_=Ar((function(e){var t=e.value;n({dataSettings:Dr(Dr({},k),{},{order:t})})}),[k]),D=Ar((function(e){var t=e.value;n({dataSettings:Dr(Dr({},k),{},{group:t})})}),[k]),T=Ar((function(e,t){var r=(0,be.Z)(k.y);t?r[e]=t:r.splice(e,1),n({dataSettings:Dr(Dr({},k),{},{y:r.filter((function(e){return e}))})})}),[k]),I=Ar((function(e){var t=e.value;n({chart:N(t),dataSettings:C(t)})}),[w,k]),A=Ar((function(e){var t=e.target.value,r=Dr(Dr({},w.options),{},{title:t});n({chart:Dr(Dr({},w),{},{options:r})})}),[w]),q=Ar((function(e,t){var r=Dr(Dr({},w.options),{},(0,f.Z)({},e,{title:t}));n({chart:Dr(Dr({},w),{},{options:r})})}),[w]),B=k||{},F=B.x,M=B.y,L=B.group,V=B.order,U=[{value:"",label:Jr}].concat((0,be.Z)(j.map((function(e){return{value:e,label:x[e].extend.caption}})))),z=[{value:"",label:Jr}].concat((0,be.Z)(F?[{value:"sum",label:"Sum"},{value:"avg",label:"Avg"},{value:"max",label:"Max"},{value:"min",label:"Min"},{value:"count",label:"Count"}]:[])),W=[{value:"",label:Jr}].concat((0,be.Z)(F&&"string"===(x[F]||{}).chartType?[{value:"ASC",label:"Asc"},{value:"DESC",label:"Desc"}]:[])),H=Vr.map((function(e){var t=e.name;return{value:t,label:t}})),J=R();return E().createElement("div",{className:Le()(e.className,Mr,"".concat(Mr,"_chart"),e.isSelected&&"".concat(Mr,"_selected"))},E().createElement(le,{type:"row align vertical space between",className:"fortressdb-block-title"},E().createElement(le,null,"Chart"),E().createElement(le,{type:"background contain",className:"fortressdb-logo fortressdb-block-logo"})),o&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:s,onClear:function(){return u(null)}}),m.connected?E().createElement(Fr,null,E().createElement(le,{type:"row wrap"},E().createElement(le,{type:"flex",className:"fortressdb-block-section",style:{marginRight:"1em"}},E().createElement(le,{className:"fortressdb-block-section-title"},"Data Source"),E().createElement(le,{type:"row wrap relative"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Table:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(Tn,{defaultSelected:h,onFetching:c,onError:u}))),E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-options"},E().createElement(le,{className:"fortressdb-block-section-title"},"X-Axis"),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Column:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:U,value:U.find((function(e){return e.value===(F||"")})),onChange:Z}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Group:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:z,value:z.find((function(e){return e.value===(L||"")})),onChange:D}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Order:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:W,value:W.find((function(e){return e.value===(V||"")})),onChange:_})))),E().createElement(le,{className:"fortressdb-block-section-options"},E().createElement(le,{className:"fortressdb-block-section-title"},"Y-Axis"),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Columns:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},P.map((function(e,t){var n=S.filter((function(n){return n===e||M.indexOf(n)<0&&(0===M.length||1===M.length&&0===t||x[n].chartType===(x[M[0]]||{}).chartType)})),r=[{value:"",label:Jr}].concat((0,be.Z)(n.map((function(e){return{value:e,label:x[e].extend.caption}}))));return E().createElement("div",{key:t,style:{paddingTop:0===t?"0":"0.3em"}},E().createElement(y.Select,{key:t,options:r,value:r.find((function(t){return t.value===e})),onChange:function(e){var n=e.value;return T(t,n)}}))}))))))))),E().createElement(le,{type:"flex",className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Chart Settings"),E().createElement(le,{type:"row wrap relative"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Type:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:H,value:H.find((function(e){return e.value===(w||{}).name})),onChange:I}))),O&&O.titles&&E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{className:"fortressdb-block-section-title"},"Labels"),O.titles.chart&&E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Title:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{value:(w.options||{}).title||"",onChange:A}))),O.titles.hAxis&&E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Horizontal:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{value:(w.options.hAxis||{}).title||"",onChange:function(e){return q("hAxis",e.target.value)}}))),O.titles.vAxis&&E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Vertical:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{value:(w.options.vAxis||{}).title||"",onChange:function(e){return q("vAxis",e.target.value)}}))))))))),E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Preview"),E().createElement(le,{type:"row wrap relative"},v&&E().createElement(Te,{chart:w,dataSettings:k,table:v})))):E().createElement(y.Notify,{message:J("plugin-not-connected")}))}function Kr(e){return E().createElement("div",{className:"fortressdb-block fortressdb-block_edit fortressdb-block_chart"},E().createElement(ee,null,E().createElement(ne,null,E().createElement(Yr,e))))}Yr.displayName="EditForm",Kr.displayName="Edit";var Gr="fortressdb-block-chart";function $r(e){var t=e.attributes;return E().createElement("div",{className:Gr,"data-attributes":JSON.stringify(t)})}$r.displayName="Save";var Xr=E().useContext,Qr=E().useEffect,ea=E().useState,ta="fortressdb-view-block",na=new z("metadata");function ra(e){var t=e.attributes,n=t.tableName,r=t.chart,a=t.dataSettings,o=Xr(te).state.options,c=ea(!1),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=ea(null),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=ea(null),b=(0,g.Z)(m,2),v=b[0],h=b[1],w=(o||{}).connected;Qr((function(){if(n&&w)return s(!0),na.subscribe({filter:{where:j.query.op("=","tableName",j.query.val(n))}},(function(e,t){if(t)d(t.message);else{var r=e.rows.find((function(e){return e.tableName===n}));if(!r)throw new Error("Selected table is not found");h(r),d(null)}})).catch((function(e){d(e.message)})).finally((function(){s(!1)})),function(){na.unsubscribe()}}),[n,w]);var k=R();return E().createElement("div",{className:"fortressdb-block fortressdb-block_view fortressdb-block_chart"},E().createElement(ne,null,E().createElement("div",{className:Le()(e.className,ta,"".concat(ta,"_chart"))},i&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:p,onClear:function(){return d(null)}}),w?v&&E().createElement(Te,{chart:r,dataSettings:a,table:v}):E().createElement(y.Notify,{message:k("plugin-not-connected")}))))}ra.displayName="View";var aa=E().useContext,oa=E().useState,ca=E().useCallback,la=E().useRef,ia=E().useEffect,sa="fortressdb-edit-block",ua=new z("licenses");function fa(e){var t=aa(te).state.options,n=oa(!1),r=(0,g.Z)(n,2),a=r[0],o=r[1],c=oa(""),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=oa([]),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=oa(null),b=(0,g.Z)(m,2),v=b[0],h=b[1],w=oa(!1),k=(0,g.Z)(w,2),O=k[0],x=k[1],N=oa(B),C=(0,g.Z)(N,2),j=C[0],S=C[1],P=la({updateLicenses:function(e,t){t?s(t.message):d(e.plans||[])}}).current;ia((function(){if(t&&t.connected)return o(!0),ua.subscribe({context:{location:j}},P.updateLicenses).then((function(){o(!1)})).catch((function(e){o(!1),s(e.message)})),function(){ua.unsubscribe()}}),[t,j]);var Z=R(),_=ca((function(e){var t=e.value;S(t)}),[]),D=ca((function(e){h(e)}),[]),T=ca((function(e){x(e)}));return E().createElement("div",{className:Le()(e.className,sa,"".concat(sa,"_price"),e.isSelected&&"".concat(sa,"_selected"))},E().createElement(le,{type:"row align vertical space between",className:"fortressdb-block-title"},E().createElement(le,null,"Price List"),E().createElement(le,{type:"background contain",className:"fortressdb-logo fortressdb-block-logo"})),t.connected?E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Preview"),p.length>0&&E().createElement(le,{type:"col content",style:{margin:"auto"}},E().createElement(le,{type:"row flex align vertical space between"},E().createElement(le,{type:"row align vertical space between",style:{minWidth:"16em"}},E().createElement(le,{style:{marginRight:"0.5em"}},Z("db-location")),E().createElement(le,{style:{width:"7em"}},E().createElement(y.Select,{options:q,value:q.find((function(e){return e.value===j})),onChange:_}))),E().createElement(le,null,E().createElement(me,{onDiscount:D,onFetching:T}))),E().createElement(le,{type:"row",className:"fortressdb-block-price-content"},p.map((function(e,t){return E().createElement(Jn,{key:e.name,plan:e,planNumber:t+1,discount:v,disabled:O})})))),a&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:i,onClear:function(){return s(null)}})):E().createElement(y.Notify,{message:Z("plugin-not-connected")}))}function pa(e){return E().createElement("div",{className:"fortressdb-block fortressdb-block_edit fortressdb-block_price"},E().createElement(ee,null,E().createElement(ne,null,E().createElement(fa,e))))}fa.displayName="EditForm",pa.displayName="Edit";var da="fortressdb-block-price";function ma(e){var t=e.attributes;return E().createElement("div",{className:da,"data-attributes":JSON.stringify(t)})}ma.displayName="Save";var ba=E().useContext,va=E().useCallback,ya=E().useState,ga="fortressdb-block-register-form";function ha(e){var t=ba(y.Popup.Context),n=R(),r=ya(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=ya(""),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=ya(e.email||""),p=(0,g.Z)(f,2),d=p[0],m=p[1],b=ya(e.name||""),v=(0,g.Z)(b,2),h=v[0],k=v[1],O=ya(e.password||""),x=(0,g.Z)(O,2),N=x[0],j=x[1],S=ya(!!e.agreePolicy),P=(0,g.Z)(S,2),Z=P[0],_=P[1],D=va((function(e){var t=e.target.value;m(t)}),[]),T=va((function(e){var t=e.target.value;k(t)}),[]),I=va((function(e){var t=e.target.value;j(t)}),[]),A=va((function(e){var t=e.target.checked;_(t)}),[]),q=va((0,w.Z)(C().mark((function n(){return C().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c(!0),n.prev=1,n.next=4,e.onSubmit&&e.onSubmit({email:d,name:h,password:N});case 4:t(),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(1),u(n.t0.message),c(!1);case 11:case"end":return n.stop()}}),n,null,[[1,7]])}))),[d,h,N,e.onSubmit,t]),B=d&&h&&N&&Z;return E().createElement("div",{className:ga},E().createElement("div",{className:"".concat(ga,"__property")},E().createElement("div",{className:"".concat(ga,"__property-label")},n("name")),E().createElement(y.Input,{className:"".concat(ga,"__input"),type:"text",value:h,onChange:T})),E().createElement("div",{className:"".concat(ga,"__property")},E().createElement("div",{className:"".concat(ga,"__property-label")},n("email")),E().createElement(y.Input,{className:"".concat(ga,"__input"),type:"email",value:d,onChange:D})),E().createElement("div",{className:"".concat(ga,"__property")},E().createElement("div",{className:"".concat(ga,"__property-label")},n("password")),E().createElement(y.Input,{className:"".concat(ga,"__input"),type:"password",value:N,onChange:I})),E().createElement("div",{className:"".concat(ga,"__policy")},E().createElement(y.Input,{className:"".concat(ga,"__checkbox"),type:"checkbox",checked:Z,onChange:A}),E().createElement("div",{className:"".concat(ga,"__agreement")},n("agreement"))),E().createElement("div",{className:"".concat(ga,"__buttons")},E().createElement(y.Button,{className:"".concat(ga,"__button_submit"),onClick:q,disabled:!B},n("submit")),E().createElement(y.Button,{className:"".concat(ga,"__button_cancel"),onClick:t},n("cancel"))),o&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:s,onClear:function(){return u(null)}}))}ha.displayName="RegisterForm";var Ea=E().useContext,wa="fortressdb-block-email-notification";function ka(e){var t=Ea(y.Popup.Context),n=R();return E().createElement("div",{className:wa},E().createElement("div",{className:"".concat(wa,"__emailing")},n("pay-emailing")),E().createElement("div",{className:"".concat(wa,"__buttons")},E().createElement(y.Button,{className:"".concat(wa,"__button_close"),onClick:t},n("close"))))}ka.displayName="EmailNotification";var Oa=E().useContext;function xa(){var e=Oa(y.Popup.Context),t=R();return E().createElement(le,{type:"col relative",style:{maxWidth:"30em",padding:"0.25em"}},E().createElement(le,{type:"row"},t("install-plugin")),E().createElement(le,{type:"row",style:{paddingTop:"0.75em"}},E().createElement(y.Button,{onClick:e},t("close"))))}xa.displayName="ThanksNotification";var Na=E().Fragment,Ca=E().useContext,ja=E().useState,Sa=E().useRef,Pa=E().useEffect,Za=E().useCallback,_a="fortressdb-view-block",Da="payment",Ta="coupon",Ia="success",Aa="PAYMENT_SUCCESS",qa="REGISTER_FORM",Ba="EMAIL_NOTIFICATION",Fa=new z("licenses");function Ma(e){var t=Ca(te).state.options,r=ja(!1),a=(0,g.Z)(r,2),o=a[0],c=a[1],l=ja(""),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=ja([]),p=(0,g.Z)(f,2),d=p[0],m=p[1],b=ja(null),v=(0,g.Z)(b,2),h=v[0],k=v[1],O=ja(B),x=(0,g.Z)(O,2),N=x[0],j=x[1],S=ja(null),P=(0,g.Z)(S,2),Z=P[0],_=P[1],D=ja(!1),T=(0,g.Z)(D,2),I=T[0],A=T[1],L=ja(!1),V=(0,g.Z)(L,2),z=V[0],W=V[1],H=ja(""),J=(0,g.Z)(H,2),Y=J[0],K=J[1],G=U().setTimeout,$=Sa({updateLicenses:function(e,t){t?u(t.message):m(e.plans||[])}}).current;Pa((function(){if(t&&t.connected)return c(!0),Fa.subscribe({context:{location:N}},$.updateLicenses).then((function(){c(!1)})).catch((function(e){c(!1),u(e.message)})),function(){Fa.unsubscribe()}}),[t,N]);var X=R(),Q=Za((function(e){var t=e.value;j(t)}),[]),ee=Za((function(e){_(e)}),[]),re=Za((function(e){A(e)})),ae=Za(function(){var e=(0,w.Z)(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(t),W(qa);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),oe=Za(function(){var e=(0,w.Z)(C().mark((function e(t,n){var r;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=10;break}return e.next=3,M(n);case 3:if(r=e.sent){e.next=6;break}throw new Error("Stripe service is unavailable.");case 6:return e.next=8,r.redirectToCheckout({sessionId:t});case 8:e.next=11;break;case 10:throw new Error("Stripe session error.");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),ce=Za(function(){var e=(0,w.Z)(C().mark((function e(t){var r,a,o,c,l,i,s,u;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,a=t.name,o=t.password,c=n.g.location,l=c.href,i=c.search,e.next=4,F.W.post("payments-session",{data:[{plan:h,coupon:(Z||{}).id||"",email:r,location:N,success:"".concat(l).concat(i?"&":"?").concat(Ia),cancel:l}],context:{}});case 4:return s=e.sent,u=s.licenseUuid,e.next=8,F.W.post("auth-signup",{data:[{email:r,password:o,name:a,url:"".concat(l).concat(i?"&":"?").concat(Da,"=").concat(encodeURI(u))}],context:{locale:"en"}});case 8:G((function(){W(Ba)}),0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[h,N]),ie=Za((function(e){var t=n.g.location,r=t.origin,a=t.pathname,o=new URLSearchParams(n.g.location.search);o.delete(e);var c=o.toString(),l=r+a+(c?"?".concat(c):"");n.g.history.replaceState(n.g.history.state,"",l)}),[n.g.location]),se=Za((function(e){W(!1)}),[]);Pa((function(){var e,t=new URLSearchParams(n.g.location.search);t.has(Ta)&&(K(t.get(Ta)),ie(Ta)),t.has(Ia)&&(W(Aa),ie(Ia)),t.has(Da)&&((e=(0,w.Z)(C().mark((function e(t){var n,r,a,o;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.prev=1,e.next=4,F.W.get("licenses-byUuid",{filter:{where:{uuid:t}}});case 4:return n=e.sent,r=(n[0]||{}).data||{},a=r.checkout_session_id,o=r.stripe_publishable_key,e.next=8,oe(a,o);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),c(!1),u(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),function(t){return e.apply(this,arguments)})(decodeURI(t.get(Da))),ie(Da))}),[n.g.location.search,ie]);var ue=(t||{}).connected;return E().createElement("div",{className:"fortressdb-block fortressdb-block_view fortressdb-block_price"},E().createElement(ne,null,E().createElement(y.Popup.Switcher,{active:z,onClose:se},E().createElement(xa,{popup:{id:Aa,title:X("payment-success")}}),E().createElement(ha,{popup:{id:qa,title:X("payment-registration")},onSubmit:ce}),E().createElement(ka,{popup:{id:Ba,title:X("payment-registration")}})),E().createElement("div",{className:Le()(e.className,_a,"".concat(_a,"_price"))},ue?E().createElement(Na,null,d.length>0&&E().createElement(Na,null,E().createElement(le,{type:"row flex align vertical space between"},E().createElement(le,{type:"row align vertical space between",style:{minWidth:"16em"}},E().createElement(le,{style:{marginRight:"0.5em"}},X("db-location")),E().createElement(le,{style:{width:"7em"}},E().createElement(y.Select,{options:q,value:q.find((function(e){return e.value===N})),onChange:Q}))),E().createElement(le,null,E().createElement(me,{onDiscount:ee,onFetching:re,code:Y}))),E().createElement(le,{type:"row",className:"fortressdb-block-price-content"},d.map((function(e,t){return E().createElement(Jn,{key:e.name,plan:e,planNumber:t+1,discount:Z,disabled:I,onPay:ae})})))),o&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:s,onClear:function(){return u(null)}})):E().createElement(y.Notify,{message:X("plugin-not-connected")}))))}function Ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function La(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ra(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Va(e,t,n){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,w.Z)(C().mark((function e(t,n,r){var a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.source){e.next=2;break}return e.abrupt("return",null);case 2:return a=t.source,e.next=5,Promise.all(t.fields.map(function(){var e=(0,w.Z)(C().mark((function e(t){var o,c,l,i,s,u,f,p;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n[t.name],e.t0=t.type,e.next="enum"===e.t0?4:"file"===e.t0?7:23;break;case 4:return c=r[t.extend.enumId]||[],o=(o?Array.isArray(o)?o:[o]:[]).map((function(e){return(c.find((function(t){return t.id===e}))||{}).label||e})).join(", "),e.abrupt("break",23);case 7:if(l=o?Array.isArray(o)?o:[o]:[],o="",!l.length){e.next=22;break}if(i=l[0],s=i.type,u=i.name,"string"!=typeof s||!s.startsWith("image")){e.next=20;break}return e.next=16,(0,I.q)(i,"thumb");case 16:f=e.sent,o='<img src="'.concat(f,"\" style='width: auto; height: auto;'/>"),e.next=22;break;case 20:p=JSON.stringify(i).replace(/"/g,"'"),o='<a href="javascript:fortressdb.file.download('.concat(p,')" title="download">').concat(u,"</a>");case 22:return e.abrupt("break",23);case 23:a=a.replace("${".concat(t.name,"}"),o);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function za(e,t){var n=e&&t&&e.match(/(\${[\w]+})/gm);return{source:e,fields:n?n.reduce((function(e,n,r){var a=n.substr(2,n.length-3);if(a){var o=t.fields.find((function(e){return e.name===a}));o&&e.push(o)}return e}),[]):[]}}function Wa(e){var t=e.split(",").map((function(e){return e.trim()})),n=Math.min.apply(Math,(0,be.Z)(t.map((function(e){return e.length}))));return{country:t.length>1?t.find((function(e){return e.length===n})):"",postalCode:t.length>1?t.find((function(e){return e.length!==n})):t[0]}}function Ha(e,t,n){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,w.Z)(C().mark((function e(t,r,a){var o,c,l,i,s,u,p,d;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.type,e.next=e.t0===Ga?3:e.t0===$a||e.t0===Xa?6:26;break;case 3:if(c=t[r.field])if("string"==typeof c)try{o=JSON.parse(c)}catch(e){}else"object"===(0,ve.Z)(c)&&(o=c);return e.abrupt("break",26);case 6:if(l=Qa(r.field),void 0===(i=t[l])){e.next=25;break}if("string"!=typeof(s=t[r.field])){e.next=25;break}if(!(s=s.trim())){e.next=25;break}if(!(u=(i||{})[r.type])||u.search!==s){e.next=18;break}o=u.location,e.next=25;break;case 18:return p=new n.g.google.maps.Geocoder,d=r.type===$a?{componentRestrictions:Wa(s)}:{address:s},e.next=22,Promise.all([new Promise((function(e,t){p.geocode(d,(function(n,r){"OK"===r?e(n[0].geometry.location):t(new Error("".concat(s," geocode was not successful for the following reason: ").concat(r)))}))})),new Promise((function(e){setTimeout(e,200)}))]).then((function(e){return e[0]}));case 22:return o=e.sent,e.next=25,a.put([La(La({},t),{},(0,f.Z)({},l,La(La({},i||{}),{},(0,f.Z)({},r.type,{search:s,location:o}))))]);case 25:return e.abrupt("break",26);case 26:return e.abrupt("return","object"===(0,ve.Z)(o)&&Number.isFinite(o.lat)&&Number.isFinite(o.lng)?o:void 0);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ya(e,t,n,r,a){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,w.Z)(C().mark((function e(t,n,r,a,o){var c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ha(t,n,r);case 2:if(c=e.sent,l=null,!c){e.next=8;break}return e.next=7,Va(a,t,o);case 7:l=e.sent;case 8:return e.abrupt("return",{position:c,info:l});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Ma.displayName="View";var Ga="position",$a="postcode",Xa="address";function Qa(e){return"_".concat(e,"_geocode")}function eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function to(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var no="fortressdb-edit-block",ro=E().useState,ao=E().useContext,oo=E().useCallback,co=E().useEffect,lo=E().useRef,io=E().useMemo,so=E().Fragment,uo=new T.F("options"),fo=[{value:Ga,label:"Coordinates (lat/lng)"},{value:$a,label:"Postcode"},{value:Xa,label:"Address"}],po=new z("objects"),mo=new z("enum_values");function bo(e){var t=e.attributes,n=e.setAttributes,r=t.tableName,a=t.mapLocation,o=t.infoWindow,c=ro(!1),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=ro(""),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=ro([]),b=(0,g.Z)(m,2),v=b[0],h=b[1],k=ro([]),O=(0,g.Z)(k,2),x=O[0],N=O[1],j=ro({}),S=(0,g.Z)(j,2),P=S[0],Z=S[1],_=ro([]),D=(0,g.Z)(_,2),T=D[0],I=D[1],A=ao(te),q=A.state,B=q.options,F=q.tables,M=void 0===F?{}:F,V=A.dispatch,U=M.current,z=M.watcher,W=ro(B&&B.googleApiKey||""),H=(0,g.Z)(W,2),J=H[0],Y=H[1],K=ro((a||{}).type||Ga),G=(0,g.Z)(K,2),$=G[0],X=G[1],Q=lo(null),ee=lo({objectsUpdate:function(e,t){if(t)d(t.message);else{var n=e.rows;N(n)}},enumValuesUpdate:function(e,t){t?d(t.message):Z(Object.keys(e).reduce((function(t,n){return t[n]=e[n].rows,t}),{}))}}).current,ne=L(U);co((function(){return function(){po.unsubscribe(),mo.unsubscribe()}}),[]),co((function(){if(U&&ne!==U){s(!0);var e=[po.subscribe({context:{tableName:U.tableName}},ee.objectsUpdate)],t=U.fields.filter((function(e){return"enum"===e.type})).map((function(e){return e.extend.enumId}));t.length?e.push(mo.subscribe({context:{enumId:t}},ee.enumValuesUpdate)):mo.unsubscribe(),Promise.all(e).catch((function(e){d(e.message)})).finally((function(){s(!1)}))}})),co((function(){U&&U.tableName!==r&&n({tableName:U.tableName,mapLocation:{}})}),[U,r]);var re=R(),ae=!(!B||!B.connected);co((function(){ae||d(re("plugin-not-connected"))}),[ae]),co((function(){U&&h((0,be.Z)(U.fields).filter((function(e){return!e.extend.isHidden})).sort((function(e,t){return e.extend.order-t.extend.order})).map((function(e){return{value:e.name,label:e.extend.caption}})))}),[U]);var oe=io((function(){return za(o,U)}),[o,U]);co((function(){a&&a.field&&x.length?(s(!0),Promise.all(x.map((function(e){return Ya(e,a,po,oe,P)}))).then(I).catch((function(e){d(e.message)})).finally((function(){s(!1)}))):I([])}),[a&&a.field,a&&a.type,x,P,oe]);var ce=oo((function(e){var t=e.value;t===Ga&&n({mapLocation:to(to({},a||{}),{},{type:t})}),X(t)}),[a]),ie=oo(function(){var e=(0,w.Z)(C().mark((function e(t){var r;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.value,n({mapLocation:to(to({},a||{}),{},{field:r,type:Ga})}),X(Ga);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a,U]),se=oo((function(e){var t=e.target.value;n({infoWindow:t})}),[]),ue=oo((0,w.Z)(C().mark((function e(){var t,r,o;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(U&&$&&a&&a.field)){e.next=17;break}if(s(!0),e.prev=2,$===Ga){e.next=10;break}if(t=U.fields,r=t.find((function(e){return e.name===a.field})),o=Qa(r.name),t.find((function(e){return e.name===o}))){e.next=10;break}return e.next=10,z.put([{fields:[].concat((0,be.Z)(t),[{name:o,type:"json",extend:{isHidden:!0,caption:"".concat(r.extend.caption," (Geocode)")}}]),id:U.id}]);case 10:n({mapLocation:to(to({},a||{}),{},{type:$})}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),d(e.t0.message);case 16:s(!1);case 17:case"end":return e.stop()}}),e,null,[[2,13]])}))),[U,$,a&&a.field]),fe=oo((function(e){var t=e.value,r=Q.current,a=r.selectionStart,o=r.selectionEnd,c=r.value,l="${".concat(t,"}");r.value=c.substr(0,a)+l+c.substr(a),r.selectionStart=a+l.length,r.selectionEnd=o+l.length,n({infoWindow:r.value})}),[]);co((function(){B&&B.googleApiKey&&Y(B.googleApiKey)}),[B]);var pe=B&&B.googleApiKey&&B.googleApiKey!==J,de=oo((0,w.Z)(C().mark((function e(){var t;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J){e.next=2;break}return e.abrupt("return");case 2:return s(!0),e.prev=3,e.next=6,uo.put({options:{googleApiKey:J}}).json();case 6:t=e.sent,pe?d(E().createElement(so,null,"Save success.",E().createElement("br",null),"To apply new API key you have to reload the page.")):V({options:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),d(e.t0.message);case 13:return e.prev=13,s(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])}))),[J,pe]),me=!B||!B.googleApiKey,ve=(a||{}).field&&$!==Ga&&$!==(a||{}).type;return E().createElement("div",{className:Le()(e.className,no,"".concat(no,"_map"),e.isSelected&&"".concat(no,"_selected"))},i&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:p,onClear:function(){return d(null)}}),E().createElement(le,{type:"row align vertical space between",className:"fortressdb-block-title"},E().createElement(le,null,"Map"),E().createElement(le,{type:"background contain",className:"fortressdb-logo fortressdb-block-logo"})),ae&&E().createElement(so,null,E().createElement(le,{type:"row wrap"},E().createElement(le,{type:"flex",className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Google API Key"),E().createElement(le,{type:"row wrap relative"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{type:"row"},E().createElement(y.Input,{disabled:i,value:J,onChange:function(e){var t=e.target.value;Y(t)},style:{marginRight:"4px",width:"25em"}}),E().createElement(y.Button,{disabled:i||!J||J===(B||{}).googleApiKey,onClick:de},"Submit")),E().createElement(y.Link,{href:"https://help.fortressdb.com/knowledge-base/google-maps-block/",target:"_blank"},"How to get an API key?"))))),!me&&E().createElement(so,null,E().createElement(le,{type:"row wrap"},E().createElement(le,{className:"fortressdb-block-section",style:{marginRight:"1em"}},E().createElement(le,{className:"fortressdb-block-section-title"},"Data Source"),E().createElement(le,{type:"row wrap relative"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Table:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(Tn,{defaultSelected:r,onFetching:s,onError:d}))),E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{type:"col",className:"fortressdb-block-section-options"},E().createElement(le,{className:"fortressdb-block-section-title"},"Location"),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Column:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:v,value:a&&a.field&&v.find((function(e){return e.value===a.field})),onChange:ie}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Type:"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Select,{options:fo,value:fo.find((function(e){return e.value===$})),onChange:ce}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"}),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},ve&&E().createElement(y.Button,{onClick:ue},"Apply Geocoding")))))))),E().createElement(le,{type:"col",className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Info Window"),E().createElement(le,{type:"col flex",className:"fortressdb-block-option"},E().createElement(y.Textarea,{innerRef:Q,value:o,onChange:se,style:{height:"154px",width:"320px"}}),E().createElement(y.Select,{options:v,value:null,onChange:fe,className:"fortressdb-button-insert-field"})))),E().createElement(le,{className:"fortressdb-block-section"},E().createElement(le,{className:"fortressdb-block-section-title"},"Preview"),E().createElement(le,{type:"col relative"},E().createElement(y.Map,{markers:T,apiKey:J}))))))}function vo(e){return E().createElement("div",{className:"fortressdb-block fortressdb-block_edit fortressdb-block_chart"},E().createElement(ee,null,E().createElement(ne,null,E().createElement(bo,e))))}bo.displayName="EditForm",vo.displayName="Edit";var yo="fortressdb-block-map";function go(e){var t=e.attributes;return E().createElement("div",{className:yo,"data-attributes":JSON.stringify(t)})}go.displayName="Save";var ho=E().useContext,Eo=E().useEffect,wo=E().useState,ko=E().useRef,Oo=E().useMemo,xo="fortressdb-view-block",No=new z("metadata"),Co=new z("objects"),jo=new z("enum_values");function So(e){var t=e.attributes,n=t.tableName,r=t.mapLocation,a=t.infoWindow,o=wo(null),c=(0,g.Z)(o,2),l=c[0],i=c[1],s=wo([]),u=(0,g.Z)(s,2),f=u[0],p=u[1],d=wo({}),m=(0,g.Z)(d,2),b=m[0],v=m[1],h=wo([]),w=(0,g.Z)(h,2),k=w[0],O=w[1],x=ho(te).state.options,N=wo(!1),C=(0,g.Z)(N,2),S=C[0],P=C[1],Z=wo(null),_=(0,g.Z)(Z,2),D=_[0],T=_[1],I=ko({metadataUpdate:function(e,t){if(t)T(t.message);else{var r=e.rows.find((function(e){return e.tableName===n}));if(!r)throw new Error("Selected table is not found");i(r)}},objectsUpdate:function(e,t){if(t)T(t.message);else{var n=e.rows;p(n)}},enumValuesUpdate:function(e,t){t?T(t.message):v(Object.keys(e).reduce((function(t,n){return t[n]=e[n].rows,t}),{}))}}).current,A=!(!x||!x.connected);Eo((function(){if(n&&A)return P(!0),No.subscribe({filter:{where:j.query.op("=","tableName",j.query.val(n))}},I.metadataUpdate).catch((function(e){T(e.message)})).finally((function(){P(!1)})),function(){No.unsubscribe()}}),[n,A]),Eo((function(){if(l){P(!0);var e=[Co.subscribe({context:{tableName:l.tableName}},I.objectsUpdate)],t=l.fields.filter((function(e){return"enum"===e.type})).map((function(e){return e.extend.enumId}));return t.length?e.push(jo.subscribe({context:{enumId:t}},I.enumValuesUpdate)):jo.unsubscribe(),Promise.all(e).catch((function(e){T(e.message)})).finally((function(){P(!1)})),function(){Co.unsubscribe(),jo.unsubscribe()}}}),[l]);var q=R();Eo((function(){x&&!A&&T(q("plugin-not-connected"))}),[x,A]);var B=Oo((function(){return za(a,l)}),[a,l]);Eo((function(){r&&r.field&&f.length?(P(!0),Promise.all(f.map((function(e){return Ya(e,r,Co,B,b)}))).then(O).catch((function(e){T(e.message)})).finally((function(){P(!1)}))):O([])}),[r,f,b,B]);var F=x&&x.googleApiKey||"";return E().createElement("div",{className:"fortressdb-block fortressdb-block_view fortressdb-block_chart"},E().createElement(ne,null,E().createElement("div",{className:Le()(e.className,xo,"".concat(xo,"_map"))},S&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:D,onClear:function(){return T(null)}}),A&&E().createElement(y.Map,{markers:k,apiKey:F}))))}So.displayName="View";var Po=n(1609),Zo=n.n(Po),_o=E().useMemo;function Do(e){var t=wp.components,n=t.Panel,r=t.PanelBody,a=t.PanelRow,o=t.Button,c=t.TextControl,l=t.Flex,i=t.FlexItem,s=t.SelectControl,u=e.variableMap,f=e.onChange,p=e.table,d=_o((function(){return p?[{value:null,label:"None"}].concat((0,be.Z)(p.fields).filter((function(e){return!e.extend.isHidden})).sort((function(e,t){return e.extend.order-t.extend.order})).map((function(e){return{value:e.name,label:e.extend.caption}}))):[]}),[p]),m=function(e){f(e)},b=function(e){return function(t){var n=(0,be.Z)(u);n[e].variable=t,m(n)}},v=function(e){return function(t){var n=(0,be.Z)(u);n[e].field=t,m(n)}},y=function(e){return function(){var t=(0,be.Z)(u);t.splice(e,1),m(t)}};return E().createElement(n,null,E().createElement(r,{title:"Variable mappings",initialOpen:!0},u.map((function(e,t){var n=e.variable,r=e.field;return E().createElement(a,{key:t},E().createElement(l,null,E().createElement(i,null,E().createElement(c,{value:n,onChange:b(t)})),E().createElement(i,null,E().createElement(s,{isEmpty:!0,options:d,value:r,onChange:v(t)})),E().createElement(i,null,E().createElement(o,{isTertiary:!0,isDestructive:!0,isSmall:!0,icon:"no",onClick:y(t)}))))})),E().createElement(a,null,E().createElement(o,{isPrimary:!0,onClick:function(){m((0,be.Z)(u).concat([{variable:"",field:null}]))}},"Add variable"))))}Do.displayName="VariableMapControl";var To=n.g.wp,Io=E().useState,Ao=E().useEffect;function qo(e){var t=e.theme,n=e.onChange,r=To.blockEditor.PanelColorSettings,a=(t.pages||{}).other||{},o=(t.pages||{}).active||{},c=t.buttons||{},l=Io(c.text||""),i=(0,g.Z)(l,2),s=i[0],u=i[1],f=Io(c.background||""),p=(0,g.Z)(f,2),d=p[0],m=p[1],b=Io(o.text||""),v=(0,g.Z)(b,2),y=v[0],h=v[1],w=Io(o.background||""),k=(0,g.Z)(w,2),O=k[0],x=k[1],N=Io(a.text||""),C=(0,g.Z)(N,2),j=C[0],S=C[1],P=Io(a.background||""),Z=(0,g.Z)(P,2),_=Z[0],D=Z[1];return Ao((function(){n({pages:{active:{text:y,background:O},other:{text:j,background:_}},buttons:{text:s,background:d}})}),[s,d,y,O,j,_]),E().createElement(r,{initialOpen:!1,title:"Pagination color scheme",colorSettings:[{value:s,onChange:u,label:"Buttons text color"},{value:d,onChange:m,label:"Buttons background color"},{value:y,onChange:h,label:"Current page text color"},{value:O,onChange:x,label:"Current page background color"},{value:j,onChange:S,label:"Other pages text color"},{value:_,onChange:D,label:"Other pages background color"}]})}qo.displayName="PaginationThemeControl";var Bo=n.g.wp,Fo=E().useState,Mo=E().useEffect;function Ro(e){var t=e.theme,n=e.onChange,r=Bo.blockEditor.PanelColorSettings,a=t.field||{},o=t.button||{},c=Fo(t.background||""),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=Fo(o.background||""),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=Fo(o.text||""),b=(0,g.Z)(m,2),v=b[0],y=b[1],h=Fo(a.background||""),w=(0,g.Z)(h,2),k=w[0],O=w[1],x=Fo(a.outline||""),N=(0,g.Z)(x,2),C=N[0],j=N[1],S=Fo(a.label_color||""),P=(0,g.Z)(S,2),Z=P[0],_=P[1],D=Fo(a.text_color||""),T=(0,g.Z)(D,2),I=T[0],A=T[1];return Mo((function(){n({background:i,field:{background:k,outline:C,label_color:Z,text_color:I},button:{text:v,background:p}})}),[i,p,v,k,C,Z,I]),E().createElement(r,{initialOpen:!1,title:"Search box color scheme",colorSettings:[{value:i,onChange:s,label:"Background"},{value:p,onChange:d,label:"Button background"},{value:v,onChange:y,label:"Button text"},{value:k,onChange:O,label:"Input background"},{value:C,onChange:j,label:"Input outline"},{value:I,onChange:A,label:"Input text"},{value:Z,onChange:_,label:"Label"}]})}Ro.displayName="SearchBoxThemeControl";var Lo=E().useState,Vo=E().Fragment,Uo=E().useEffect,zo=E().useContext,Wo=E().useMemo,Ho=["text","string","enum"];function Jo(e){if(navigator.clipboard&&n.g.isSecureContext)return navigator.clipboard.writeText(e);var t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((function(e,n){document.execCommand("copy")?e():n(),t.remove()}))}function Yo(e){var t=e.rowCount,n=void 0===t?10:t,r=e.onRowCountChange,a=void 0===r?function(){}:r,o=(e.columnCount,e.onColumnCountChange,e.isSingleItem),c=void 0!==o&&o,l=e.onIsSingleItemChange,i=void 0===l?function(){}:l,s=e.tableName,u=e.onTableChange,f=void 0===u?function(){}:u,p=e.variableMap,d=void 0===p?[]:p,m=e.searchOptions,b=void 0===m?[]:m,v=e.onSearchOptionsChange,h=void 0===v?function(){}:v,k=e.onAddTemplate,O=void 0===k?function(){}:k,x=e.onRemoveTemplate,N=void 0===x?function(){}:x,j=e.templatesCount,S=void 0===j?0:j,P=zo(te).state.tables,Z=(void 0===P?{}:P).current,_=L(Z),D=Lo(!1),T=(0,g.Z)(D,2),I=T[0],A=T[1],q=Lo(""),B=(0,g.Z)(q,2),F=B[0],M=B[1],R=Wo((function(){return Z?d.filter((function(e){var t=e.variable,n=e.field;return!!t&&!!n})).map((function(e){var t=e.variable,n=e.field,r=(0,be.Z)(Z.fields).find((function(e){return e.name===n}));try{return{value:t,label:r.extend.caption}}catch(e){return{value:t,label:t}}})):[]}),[d,Z]);Uo((function(){Z&&Z!==_&&f(Z)}),[Z]);var V=Wo((function(){return Z?(0,be.Z)(Z.fields).filter((function(e){return!e.extend.isHidden&&Ho.includes(e.type)})).sort((function(e,t){return e.extend.order-t.extend.order})).map((function(e){return{value:e.name,label:e.extend.caption}})):[]}),[Z]);return E().createElement(Vo,null,I&&E().createElement(y.Spinner,null),E().createElement(y.Notify,{message:F,onClear:function(){return M(null)}}),E().createElement(le,{type:"row align vertical space between",className:"fortressdb-block-title"},E().createElement(le,null,"Custom Data"),E().createElement(le,{type:"background contain",className:"fortressdb-logo fortressdb-block-logo"})),E().createElement(le,{type:"row wrap"},E().createElement(le,{className:"fortressdb-block-section",style:{marginRight:"1em",flexGrow:1}},E().createElement(le,{className:"fortressdb-block-section-title"},"Data source"),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Table"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(Tn,{defaultSelected:s,onFetching:A,onError:M}))),E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Rows"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{type:"number",value:n,onChange:function(e){var t=e.target.value;a(parseInt(t))}})))),E().createElement(le,{className:"fortressdb-block-section",style:{flexGrow:1}},E().createElement(le,{className:"fortressdb-block-section-title"},"Search options"),E().createElement(le,{type:"col relative",style:{maxWidth:"19em"}},E().createElement(y.Select,{isMulti:!0,isClearable:!0,options:V,value:V.filter((function(e){var t=e.value;return b.includes(t)})),onChange:function(e){h(e.map((function(e){return e.value})))}})),E().createElement(le,{className:"fortressdb-block-section-title"},"Select field to copy to clipboard"),E().createElement(le,{type:"col relative"},E().createElement(y.Select,{isMulti:!1,isClearable:!1,options:R,onChange:function(e){return t=e.value,void(0,w.Z)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jo("${"+t+"}");case 2:case"end":return e.stop()}}),e)})))();var t}})))),E().createElement(le,{type:"row wrap"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Get ID from URL"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{type:"checkbox",disabled:S>1,checked:c,onChange:function(e){var t=e.target.checked;i(t)}})))),E().createElement(le,{type:"row wrap"},E().createElement(le,{type:"row wrap",className:"fortressdb-block-option"},E().createElement(le,{type:"col",className:"fortressdb-block-option-label"},"Alternate rows"),E().createElement(le,{type:"col",className:"fortressdb-block-option-value"},E().createElement(y.Input,{type:"checkbox",checked:S>1,onChange:function(e){e.target.checked?O():N(1)}})))))}function Ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Go(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ko(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ko(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Yo.displayName="Toolbar";var $o=n.g.wp;function Xo(e){var t=e.options,n=e.tableFields,r=void 0===n?[]:n,a=e.mapping,o=void 0===a?{}:a,c=e.onChange,l=e.labelStyle,i=e.onLabelStyleChange,s=$o.components,u=s.Panel,p=s.PanelBody,d=s.PanelRow,m=s.TextControl,b=s.ToggleControl,v=function(e){var t,n=r.find((function(t){return t.name===e}));return(null==n||null===(t=n.extend)||void 0===t?void 0:t.caption)||"Error"};return React.createElement(u,null,React.createElement(p,{title:"Search field labels",initialOpen:!1},t.map((function(e,t){return React.createElement(d,{key:t},React.createElement(m,{value:(r=e,a=o[r],a||v(r)),label:v(e),onChange:(n=e,function(e){c(Go(Go({},o),{},(0,f.Z)({},n,e)))})}));var n,r,a})),React.createElement(d,null,React.createElement(b,{label:"Labels on the left",help:"left"===l?"Toggle to put labels on top of the field":"Toggle to put labels on the left of the field",checked:"left"===l,onChange:i}))))}Xo.displayName="SearchLabelsControl";const Qo=window.wp.blocks,ec=window.wp.data,tc=window.wp.blockEditor;function nc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ac=E().useEffect,oc=E().useState,cc=E().useMemo,lc=E().Fragment,ic={0:"Even Rows",1:"Odd Rows"};function sc(e){var t,n,r,a,o=e.attributes,c=e.setAttributes,l=(0,ec.useDispatch)("core/block-editor"),i=l.replaceInnerBlocks,s=l.updateBlockAttributes,u=(0,tc.useBlockEditContext)().clientId,f=(0,ec.useSelect)((function(e){return e("core/block-editor").getBlocks(u)}),[u]),p=o.tableName,d=oc(o.rowCount||10),m=(0,g.Z)(d,2),b=m[0],v=m[1],y=oc(o.columnCount||1),h=(0,g.Z)(y,2),w=h[0],k=h[1],O=oc(null),x=(0,g.Z)(O,2),N=x[0],C=x[1],j=oc(o.searchOptions||[]),S=(0,g.Z)(j,2),P=S[0],Z=S[1],_=oc(o.isSingleItem||!1),D=(0,g.Z)(_,2),T=D[0],I=D[1],A=oc((null==o||null===(t=o.theme)||void 0===t?void 0:t.pagination)||{}),q=(0,g.Z)(A,2),B=q[0],F=q[1],M=oc((null==o||null===(n=o.theme)||void 0===n?void 0:n.searchbox)||{}),R=(0,g.Z)(M,2),L=R[0],V=R[1],U=oc(o.searchFieldLabels||{}),z=(0,g.Z)(U,2),W=z[0],H=z[1],J=oc((null==o||null===(r=o.theme)||void 0===r||null===(a=r.searchbox)||void 0===a?void 0:a.label_style)||"left"),Y=(0,g.Z)(J,2),K=Y[0],G=Y[1],$=oc(Object.entries(o.variableMap||{}).map((function(e){var t=(0,g.Z)(e,2);return{variable:t[0],field:t[1]}}))),X=(0,g.Z)($,2),Q=X[0],ee=X[1],te=cc((function(){return f.length}),[f]),ne=function(e){return rc(rc({},e),{},{title:ic[e.index],parentId:u})};return ac((function(){if(N){var e=Q.filter((function(e){var t=e.variable,n=e.field;return t&&n})).reduce((function(e,t){var n=t.variable,r=t.field;return e[n]=r,e}),{});c(rc(rc({},o),{},{tableName:N.tableName,rowCount:b,columnCount:w,variableMap:e,searchOptions:P,isSingleItem:T,theme:{pagination:B,searchbox:rc(rc({},L),{},{label_style:K})},searchFieldLabels:W}))}}),[N,b,w,Q,P,T,B,L,W,K]),ac((function(){var e=f.length>1;f.map((function(t){var n=t.clientId;return s(n,{showHeader:e})}))}),[f]),ac((function(){var e=Object.keys(o.blocks).length>0?o.blocks:{0:""},t=!1,n=Object.entries(e).map((function(e){var n=(0,g.Z)(e,2),r=n[0],a=n[1],o=ne({index:parseInt(r),closed:t});return t=!0,(0,Qo.createBlock)("fortressdb/custom-data-template",o,(0,Qo.parse)(a))}));i(u,n)}),[]),E().createElement("div",{className:"fortressdb-edit-block"},E().createElement(tc.InspectorControls,null,E().createElement(Do,{variableMap:Q,table:N,onChange:ee}),!Zo()(P)&&E().createElement(lc,null,E().createElement(Xo,{options:P,tableFields:N?N.fields:[],mapping:W,onChange:H,labelStyle:K,onLabelStyleChange:function(e){return G(e?"left":"top")}}),E().createElement(Ro,{theme:L,onChange:V})),E().createElement(qo,{theme:B,onChange:F})),E().createElement(Yo,{tableName:p,rowCount:b,onRowCountChange:v,columnCount:w,onColumnCountChange:k,onTableChange:function(e){C(e);var t=["createdAt","updatedAt"],n=(0,be.Z)(e.fields).filter((function(e){return!e.extend.isHidden&&!t.includes(e.name)})).reduce((function(e,t){var n=(t.extend.caption||t.name).replace(/[^a-zA-Z0-9_\s]/gim,"").replace(/\s+/g,"_").toLowerCase();return e.push({variable:n,field:t.name}),e}),[]);ee(n)},variableMap:Q,searchOptions:P,onSearchOptionsChange:Z,isSingleItem:T,onIsSingleItemChange:I,onAddTemplate:function(){var e=(0,Qo.createBlock)("fortressdb/custom-data-template",ne({index:1}),[]);i(u,[].concat((0,be.Z)(f),[e])),I(!1)},onRemoveTemplate:function(e){i(u,(0,be.Z)(f).filter((function(t){return t.attributes.index!==e})));var t=rc({},o.blocks);delete t[e],c({blocks:t})},templatesCount:te}),E().createElement(tc.InnerBlocks,{renderAppender:!1,allowedBlocks:["fortressdb/custom-data-template"]}))}function uc(e){return E().createElement("div",{className:"fortressdb-block fortressdb-block_edit fortressdb-block_merge"},E().createElement(ee,null,E().createElement(ne,null,E().createElement(sc,e))))}sc.displayName="EditForm",uc.displayName="Edit";var fc="fortressdb-block-custom-data",pc=n.g.wp;function dc(e){var t=e.attributes,n=pc.blocks,r=n.getSaveContent,a=n.parse,o=n.cloneBlock,c={},l=["blocks"],i=function e(t){var n=t.innerBlocks.map(e);return o(t,function(e){if(!e.attributes.fdb_block)return{};switch(e.name){case"core/image":return{url:e.attributes.fdb_field};default:return{}}}(t),n)};Object.entries(t.blocks).map((function(e){var t=(0,g.Z)(e,2),n=t[0],o=t[1],l=a(o).map((function(e){var t=i(e);return r(t.name,t.attributes,t.innerBlocks)})).join("\n\n");c[n]=btoa(l)})),t.templates=c;var s=Object.keys(t).filter((function(e){return!l.includes(e)})).reduce((function(e,n){return e[n]=t[n],e}),{});return React.createElement("div",{className:fc,"data-attributes":JSON.stringify(s)})}dc.displayName="Save";var mc=E().Fragment;function bc(e){var t=e.label,n=e.disabled,r=e.onClick,a=e.direction,o=e.colors,c=void 0===o?{}:o,l={backgroundColor:c.background,color:c.text},i=n?E().createElement("span",{className:Le()(["label","disabled",a])},t):E().createElement("a",{href:"",className:Le()(["label","enabled",a]),onClick:function(e){e.preventDefault(),e.stopPropagation(),r()}},t);return E().createElement("div",{style:l,className:"pagination-button"},i)}function vc(e){var t=e.label,n=e.isCurrent,r=e.onClick,a=e.colors,o=(a.pages||{}).other||{},c=(a.pages||{}).active||{};return E().createElement("a",{href:"",key:0,className:n?"current":"other",onClick:r,style:{backgroundColor:n?c.background:o.background,color:n?c.text:o.text}},t)}function yc(e){var t=e.page,n=void 0===t?0:t,r=e.perPage,a=void 0===r?1:r,o=e.totalObjects,c=void 0===o?0:o,l=e.onPageChange,i=void 0===l?function(){}:l,s=e.pagesToShow,u=void 0===s?5:s,f=e.colors,p=void 0===f?{}:f,d=p.buttons||{},m=Math.ceil(c/a),b=!1,v=!1;if(m<=1)return E().createElement("div",null);var y=function(e){return function(t){t.preventDefault(),e<0||e>m||i(e)}},g=function(){return!(n>=m-1)},h=function(){return!(n<=0)},w=[],k=Math.floor(Math.min(m,u)/2),O=Math.max(0,n-k),x=Math.min(O+u,m);0!==(O=Math.max(x-u,0))&&(b=!0,O++),x!==m&&(v=!0,x--);for(var N=O;N<x;N++)w.push(N);return E().createElement("div",{className:"pagination-container"},E().createElement("div",{className:"fdb-pagination"},E().createElement(bc,{onClick:function(){h()&&i(n-1)},disabled:!h(),label:String.fromCharCode(171),direction:"dec",colors:d}),E().createElement("div",{className:"pagination-pages"},b&&E().createElement(mc,null,E().createElement(vc,{label:1,onClick:y(0),isCurrent:0===n,colors:p}),E().createElement("span",{className:"hellip"},"")),w.map((function(e){return E().createElement(vc,{label:e+1,isCurrent:e===n,colors:p,onClick:y(e),key:e})})),v&&E().createElement(mc,null,E().createElement("span",{className:"hellip"},""),E().createElement(vc,{label:m,onClick:y(m-1),isCurrent:n===m-1,colors:p}))),E().createElement(bc,{onClick:function(){g()&&i(n+1)},disabled:!g(),label:String.fromCharCode(187),direction:"inc",colors:d})))}function gc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gc(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}bc.displayName="StepButton",vc.displayName="PageButton",yc.displayName="Pagination";var Ec=E().useState,wc=new Map([["string",kc],["text",kc],["enum",Oc]]);function kc(e){var t=e.name,n=e.onChange,r=e.inputStyle;return E().createElement(y.Input,{id:t,onChange:function(e){var t=e.target.value;n(t)},style:r})}function Oc(e){var t,n=e.onChange,r=e.inputStyle,a=e.fieldEnum,o=e.field,c=Object.entries(a).map((function(e){var t=(0,g.Z)(e,2);return{value:t[0],label:t[1]}})),l={control:function(e){return hc(hc({},e),{},{backgroundColor:r.backgroundColor?r.backgroundColor:null==e?void 0:e.backgroundColor,borderColor:r.borderColor?r.borderColor+" !important":null==e?void 0:e.borderColor,borderWidth:r.borderWidth?r.borderWidth:e.borderWidth})},singleValue:function(e){return hc(hc({},e),{},{color:r.color?r.color:e.color})},multiValue:function(e){return hc(hc({},e),{},{color:r.color?r.color:e.color})},multiValueLabel:function(e){return hc(hc({},e),{},{color:r.color?r.color:e.color})}},i=(null==o||null===(t=o.extend)||void 0===t?void 0:t.isMultiple)||!1;return E().createElement(y.Select,{styles:l,options:c,isMulti:i,onChange:function(e){var t;t=(t=Array.isArray(e)?(0,be.Z)(e):[e]).filter((function(e){return!!e})),n(t.map((function(e){return e.value})))},isClearable:!0})}function xc(e){var t=e.inputStyle,n=e.labelStyle,r=e.classes,a=e.name,o=e.label,c=e.onChange,l=e.tableField,i=e.fieldEnum;if(!wc.has(l.type))return E().createElement(E().Fragment,null);var s=wc.get(l.type);return E().createElement("div",{className:Le()(r)},E().createElement("label",{htmlFor:a,style:n},o,":"),E().createElement(s,{name:a,onChange:c,inputStyle:t,fieldEnum:i,field:l}))}function Nc(e){var t,n,r,a,o,c,l,i=e.options,s=void 0===i?[]:i,u=e.onSearch,p=void 0===u?function(){}:u,d=e.labels,m=void 0===d?{}:d,b=e.theme,v=void 0===b?{}:b,h=e.tableFields,w=e.enumValues,k=Ec({}),O=(0,g.Z)(k,2),x=O[0],N=O[1],C=s.length>1?["field"]:["field","single"],j={backgroundColor:null==v?void 0:v.background},S={backgroundColor:null==v||null===(t=v.button)||void 0===t?void 0:t.background,color:null==v||null===(n=v.button)||void 0===n?void 0:n.text},P={backgroundColor:null==v||null===(r=v.field)||void 0===r?void 0:r.background,color:null==v||null===(a=v.field)||void 0===a?void 0:a.text_color,borderColor:null==v||null===(o=v.field)||void 0===o?void 0:o.outline,borderWidth:null!=v&&null!==(c=v.field)&&void 0!==c&&c.outline?"thin":"none"},Z={color:null==v||null===(l=v.field)||void 0===l?void 0:l.label_color};return"top"===(null==v?void 0:v.label_style)&&C.push("labelstop"),E().createElement("div",{className:"searchbar",style:j},E().createElement("div",{className:"fieldset"},s.map((function(e,t){var n,r,a,o,c=h[e.value],l=null!=c&&null!==(n=c.extend)&&void 0!==n&&n.enumId&&(w||{})[null==c||null===(r=c.extend)||void 0===r?void 0:r.enumId]||{};return E().createElement(xc,{key:t,inputStyle:P,labelStyle:Z,classes:C,name:e.value,onChange:(a=e.value,o=c.type,function(e){N(hc(hc({},x),{},(0,f.Z)({},a,{type:o,value:e})))}),label:m[e.value]||e.label,tableField:c,fieldEnum:l})}))),E().createElement(y.Button,{onClick:function(){p(x)},className:"btn-search",style:S},"Search"))}function Cc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cc(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Pc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pc(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function Pc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}kc.displayName="StringInput",Oc.displayName="SelectInput",xc.displayName="SearchField",Nc.displayName="SearchBox";var Zc=E().useEffect,_c=E().useState,Dc=E().useMemo,Tc=n(5664),Ic={},Ac=function(){var e=(0,w.Z)(C().mark((function e(t,n,r,a){var o,c,l,i,s,u,f,p,d;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o={},c=[],l=0,i=Object.entries(a);l<i.length;l++)s=(0,g.Z)(i[l],2),u=s[0],f=s[1],p=n[f],d=t[f],function(){switch(p.type){case"enum":var e=d?Array.isArray(d)?d:[d]:[],t=r[p.extend.enumId]||{};d=e.map((function(e){return t[e]||e})).join(", ");break;case"datetime":d=P(d);break;case"file":if(!d){d="".concat(fortressdbStaticUrl,"/build/").concat(Tc);break}d.length>0?(d=d[0],void 0!==Ic[d.uuid]?d=Ic[d.uuid]:(c.push({variable:u,value:d}),d="".concat(fortressdbStaticUrl,"/build/").concat(Tc))):d="".concat(fortressdbStaticUrl,"/build/").concat(Tc)}}(),o[u]=d;return e.abrupt("return",{data:o,files:c});case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function qc(e){var t=e.template,n=e.entry,r=e.tableFields,a=e.enumValues,o=e.variableMap,c=_c({}),l=(0,g.Z)(c,2),i=l[0],s=l[1],u=_c([]),f=(0,g.Z)(u,2),p=f[0],d=f[1],m=_c(""),b=(0,g.Z)(m,2),v=b[0],y=b[1];return Zc((function(){(0,w.Z)(C().mark((function e(){var t,c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ac(n,r,a,o);case 2:t=e.sent,c=t.data,l=t.files,s(c),d(l);case 7:case"end":return e.stop()}}),e)})))()}),[n]),Zc((function(){p.length<=0||(0,w.Z)(C().mark((function e(){var t,n,r,a,o,c;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=Sc(p),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=17;break}if(a=r.value,o=a.variable,c=a.value,void 0===Ic[c.uuid]){e.next=11;break}t[o]=Ic[c.uuid],e.next=15;break;case 11:return e.next=13,(0,I.q)(c,"thumb");case 13:t[o]=e.sent,Ic[c.uuid]=t[o];case 15:e.next=4;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),n.e(e.t0);case 22:return e.prev=22,n.f(),e.finish(22);case 25:s(jc(jc({},i),t));case 26:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})))()}),[p]),Zc((function(){Zo()(i)||y(function(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var a=(0,g.Z)(r[n],2),o=a[0],c=a[1];e=e.replaceAll("${"+o+"}",c)}return e}(t,i))}),[i]),E().createElement("div",{dangerouslySetInnerHTML:{__html:v}})}function Bc(e){var t=e.attributes,n=t.tableName,r=t.rowCount,a=t.columnCount,o=t.searchOptions,c=t.searchFieldLabels,l=void 0===c?{}:c,i=t.variableMap,s=t.isSingleItem,u=t.theme,f=Object.entries(e.attributes.templates||{}).reduce((function(e,t){var n=(0,g.Z)(t,2),r=n[0],a=n[1];return e[r]=atob(a),e}),{}),p=_c(null),d=(0,g.Z)(p,2),m=(d[0],d[1]),b=_c(null),v=(0,g.Z)(b,2),y=v[0],h=v[1],k=_c(null),O=(0,g.Z)(k,2),x=O[0],N=O[1],S=_c(0),P=(0,g.Z)(S,2),Z=P[0],_=P[1],D=_c(0),T=(0,g.Z)(D,2),I=T[0],A=T[1],q=_c([]),B=(0,g.Z)(q,2),M=B[0],R=B[1],L=parseInt(new URL(document.location.href).searchParams.get("id")),V=Object.keys(f),U={limit:s?1:r*a,offset:0,order:[j.query.orderBy("id",j.query.ASC)]};s&&(U.where=j.query.op("=","id",j.query.val(L)));var z=_c(U),W=(0,g.Z)(z,2),H=W[0],J=W[1];Zc((function(){(0,w.Z)(C().mark((function e(){var t,r,a,o,c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.W.get("metadata",{filter:{where:j.query.op("=","tableName",j.query.val(n))}});case 3:if(1===(t=e.sent).count){e.next=6;break}throw new Error("Table not found");case 6:return r=t.rows.find((function(e){return e.tableName===n})),a=r.fields.reduce((function(e,t){return e[t.name]=t,e}),{}),h(a),o=r.fields.filter((function(e){return"enum"===e.type})).map((function(e){return e.extend.enumId})),e.next=12,F.W.get("enum_values",{context:{enumId:o}});case 12:c=e.sent,l=Object.keys(c).reduce((function(e,t){return e[t]=c[t].rows.reduce((function(e,t){return e[t.id]=t.label,e}),{}),e}),{}),N(l),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Metadata fetch:",e.t0,n),m(e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))()}),[n]),Zc((function(){null!==y&&null!==x&&(0,w.Z)(C().mark((function e(){var t,r,a,o;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={context:{tableName:n},filter:H},e.prev=1,e.next=4,F.W.get("objects",t);case 4:r=e.sent,a=r.count,o=r.rows,A(a),R(o),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))()}),[H,x]);var Y=Dc((function(){return y&&o?Object.keys(y).filter((function(e){return o.includes(e)})).map((function(e){return{value:y[e].name,label:y[e].extend.caption}})):[]}),[y]);Zc((function(){J(jc(jc({},H),{},{offset:s?0:Z*a*r}))}),[Z]);var K=function(e){var t=e%V.length,n=V[t];return f[n]};return s&&!L?E().createElement("div",null):E().createElement("div",{className:"fortressdb-custom-data-block-view"},!s&&Y.length>0&&E().createElement(Nc,{options:Y,labels:l,onSearch:function(e){var t=Object.entries(e).filter((function(e){var t=(0,g.Z)(e,2),n=t[0],r=t[1].value;return n&&!Zo()(r)})).map((function(e){var t=(0,g.Z)(e,2),n=t[0],r=t[1],a=r.type,o=r.value;return"text"===a||"string"===a?j.query.op("iLike",n,j.query.val("%".concat(o.replace(/[\0\n\r\b\t\\'"\x1a]/g,(function(e){switch(e){case"\0":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"\t":return"\\t";case"":return"\\Z";case"'":return"''";case'"':return'""';default:return"\\"+e}})),"%"))):"enum"===a?j.query.op("contains",n,j.query.val(o.map((function(e){return parseInt(e)})))):null})),n={};t.length&&(n=1===t.length?t[0]:j.query.op.apply(j.query,["and"].concat((0,be.Z)(t))));var r=jc(jc({},H),{},{page:0,where:n});Zo()(n)&&delete r.where,J(r),_(0)},theme:u.searchbox||{},tableFields:y,enumValues:x}),M.map((function(e,t){return E().createElement(qc,{key:t,template:K(t),entry:e,tableFields:y,enumValues:x,variableMap:i})})),!s&&E().createElement(yc,{page:Z,totalObjects:I,perPage:r*a,onPageChange:function(e){return _(e)},colors:u.pagination||{}}))}function Fc(){return React.createElement("div",{className:"placeholder"},React.createElement("div",{className:"text"},"Insert your template here."))}qc.displayName="Element",Bc.displayName="View",Fc.displayName="Placeholder";const Mc=window.wp.components;function Rc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rc(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vc=E().useEffect,Uc=E().useState,zc=E().Fragment,Wc=["core/paragraph","core/table","core/heading","core/columns","core/image"];function Hc(e){var t=e.attributes,n=t.parentId,r=t.index,a=t.showHeader,o=t.title,c=(0,ec.useDispatch)("core/block-editor").updateBlockAttributes,l=(0,tc.useBlockEditContext)().clientId,i=(0,ec.useSelect)((function(e){return e("core/block-editor").getBlocks(l)}),[l]),s=(0,ec.useSelect)((function(e){return(0,e("core/block-editor").getBlockAttributes)(n)}),[n]),u=Uc(t.closed),p=(0,g.Z)(u,2),d=p[0],m=p[1];return Vc((function(){c(n,{blocks:Lc(Lc({},s.blocks),(0,f.Z)({},r,(0,Qo.serialize)(i)))})}),[i]),E().createElement("div",{className:"fortressdb-custom-data-template"},a&&E().createElement("div",{className:"header"},E().createElement("span",null,o),E().createElement(Mc.Icon,{icon:d?"arrow-down":"arrow-up",className:"icon",onClick:function(){return m(!d)}})),!d&&E().createElement(zc,null,0===i.length&&E().createElement(Fc,null),E().createElement(tc.InnerBlocks,{renderAppender:function(){return E().createElement(tc.InnerBlocks.ButtonBlockAppender,null)},allowedBlocks:Wc})))}function Jc(){return null}Hc.displayName="Edit",fr(Or,Zr),fr(Gr,ra),fr(da,Ma),fr(yo,So),fr(fc,Bc);var Yc={url:n(9187).q,download:n(312).S}},1897:(e,t,n)=>{n.p="/wp-content/plugins/fortressdb/build/"},2361:(e,t,n)=>{"use strict";n.d(t,{F:()=>d});var r=n(6156),a=n(6610),o=n(5991),c=n(5716);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=JSON.stringify,u=n.g.fortressdbNonce,f=n.g.ajaxurl,p=void 0===f?"/wp-admin/admin-ajax.php":f,d=function(){function e(t){(0,a.Z)(this,e),this.name=t}return(0,o.Z)(e,[{key:"url",value:function(){return"".concat(p,"?action=").concat("fortressdb_api_backend","&nonce=").concat(u)}},{key:"request",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i({_method:t,_name:this.name},n);e.accessToken&&(r._accessToken=e.accessToken);var a=new c.a(this.url(),{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:s(r)});return a}},{key:"get",value:function(e){return this.request("GET",e)}},{key:"post",value:function(e){return this.request("POST",e)}},{key:"put",value:function(e){return this.request("PUT",e)}},{key:"delete",value:function(e){return this.request("DELETE",e)}}]),e}();d.accessToken=""},5716:(e,t,n)=>{"use strict";n.d(t,{a:()=>r.HttpRequest});var r=n(3861)},312:(e,t,n)=>{"use strict";n.d(t,{S:()=>c});var r=n(2092),a=n(3861),o=n.g.fortressdbBackendUrl;function c(e,t,n){return r.W.authenticate().then((function(r){var c=r.socket;return a.FileUtils.download(o,c.signedAuthToken,e,t,n)}))}},9187:(e,t,n)=>{"use strict";n.d(t,{q:()=>c});var r=n(2092),a=n(3861),o=n.g.fortressdbBackendUrl;function c(e,t,n){return r.W.authenticate().then((function(r){var c=r.socket;return a.FileUtils.getUrl(o,c.signedAuthToken,e,t,n)}))}},2092:(e,t,n)=>{"use strict";n.d(t,{W:()=>f});var r=n(6156),a=n(2361),o=n(3861);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var i=n.g,s=i.fortressdbSocketOptions,u=i.fortressdbInitialOptions,f=new o.Socket(l(l({},s||{}),{},{client:function(){return delete a.F.accessToken,new a.F("auth/subscribe").post().json()},storageName:"fortressdb_data",verify:function(){return u.userId===f.storage.getItem("userId")},onAuthenticate:function(){f.storage.setItem("userId",u.userId)}}))},5664:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"assets/c050fe7d1294aa622cdb70aee1acb431.png"},3861:t=>{"use strict";t.exports=e},3804:e=>{"use strict";e.exports=window.React},7196:e=>{"use strict";e.exports=window.ReactDOM},9948:e=>{"use strict";e.exports=t}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return r[e](n,n.exports,o),n.loaded=!0,n.exports}o.m=r,n=[],o.O=(e,t,r,a)=>{if(!t){var c=1/0;for(s=0;s<n.length;s++){for(var[t,r,a]=n[s],l=!0,i=0;i<t.length;i++)(!1&a||c>=a)&&Object.keys(o.O).every((e=>o.O[e](t[i])))?t.splice(i--,1):(l=!1,a<c&&(c=a));l&&(n.splice(s--,1),e=r())}return e}a=a||0;for(var s=n.length;s>0&&n[s-1][2]>a;s--)n[s]=n[s-1];n[s]=[t,r,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={747:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[c,l,i]=n,s=0;for(r in l)o.o(l,r)&&(o.m[r]=l[r]);if(i)var u=i(o);for(t&&t(n);s<c.length;s++)a=c[s],o.o(e,a)&&e[a]&&e[a][0](),e[c[s]]=0;return o.O(u)},n=self.webpackChunkfortressdb=self.webpackChunkfortressdb||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var c=o.O(void 0,[673],(()=>o(7679)));return o.O(c)})()}));